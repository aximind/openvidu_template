<html style="height: 100vh; width: 100vw; margin: 0; padding: 0;">

<head>
    <script>
        !function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return r(t[s][1][e]||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}}()({1:[function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var r,o,s,a;if(d(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=u(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):v(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(o){i.once&&e.removeEventListener(t,r),n(o)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var d=c.length,u=v(c,d);for(n=0;n<d;++n)o(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return d(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,o,s;if(d(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},{}],2:[function(e,t,n){"use strict";var i=e("normalice");t.exports=function(t){var n,r={stun:(t||{}).stun||e("./stun.json"),turn:(t||{}).turn||e("./turn.json")},o=(t||{}).stunCount||2,s=(t||{}).turnCount||0;function a(e,t){for(var n,o=[],s=[].concat(r[e]);s.length&&o.length<t;)n=Math.random()*s.length|0,o=o.concat(s.splice(n,1));return o.map(function(t){return"string"==typeof t||t instanceof String?i(e+":"+t):t})}return n=[].concat(a("stun",o)),s&&(n=n.concat(a("turn",s))),n}},{"./stun.json":3,"./turn.json":4,normalice:7}],3:[function(e,t,n){t.exports=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]},{}],4:[function(e,t,n){t.exports=[]},{}],5:[function(e,t,n){var i,r=e("wildemitter");"undefined"!=typeof window&&(i=window.AudioContext||window.webkitAudioContext);var o=null;t.exports=function(e,t){var n=new r;if(!i)return n;var s,a,c,d=(t=t||{}).smoothing||.1,u=t.interval||50,l=t.threshold,p=t.play,f=t.history||10,h=!0;o=t.audioContext||o||new i,(c=o.createAnalyser()).fftSize=512,c.smoothingTimeConstant=d,a=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(s=o.createMediaElementSource(e),void 0===p&&(p=!0),l=l||-50):(s=o.createMediaStreamSource(e),l=l||-50),s.connect(c),p&&c.connect(o.destination),n.speaking=!1,n.suspend=function(){return o.suspend()},n.resume=function(){return o.resume()},Object.defineProperty(n,"state",{get:function(){return o.state}}),o.onstatechange=function(){n.emit("state_change",o.state)},n.setThreshold=function(e){l=e},n.setInterval=function(e){u=e},n.stop=function(){h=!1,n.emit("volume_change",-100,l),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),c.disconnect(),s.disconnect()},n.speakingHistory=[];for(var v=0;v<f;v++)n.speakingHistory.push(0);var m=function(){setTimeout(function(){if(h){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,r=t.length;i<r;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}(c,a);n.emit("volume_change",e,l);var t=0;if(e>l&&!n.speaking){for(var i=n.speakingHistory.length-3;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<l&&n.speaking){for(i=0;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>l)),m()}},u)};return m(),n}},{wildemitter:24}],6:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],7:[function(e,t,n){var i=["stun:","turn:"];t.exports=function(e){var t,n,r=(e||{}).url||e,o={};return"string"==typeof r||r instanceof String?(r=r.trim(),(t=i[i.indexOf(r.slice(0,5))])?(n=(r=r.slice(5)).split("@"),o.username=e.username,o.credential=e.credential,n.length>1&&(r=n[1],n=n[0].split(":"),o.username=n[0],o.credential=(e||{}).credential||n[1]||""),o.url=t+r,o.urls=[o.url],o):e):e}},{}],8:[function(e,t,n){(function(e){(function(){(function(){"use strict";var i={function:!0,object:!0},r=i[typeof window]&&window||this,o=i[typeof n]&&n,s=i[typeof t]&&t&&!t.nodeType&&t,a=o&&s&&"object"==typeof e&&e;!a||a.global!==a&&a.window!==a&&a.self!==a||(r=a);var c=Math.pow(2,53)-1,d=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,p=u.toString;function f(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function h(e){return e=E(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:f(e)}function v(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function m(e){return null==e?f(e):p.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function b(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=c)for(;++n<i;)t(e[n],n,e);else v(e,t)}(e,function(i,r){n=t(n,i,r,e)}),n}function E(e){return String(e).replace(/^ +| +$/g,"")}var y=function e(t){var n=r,i=t&&"object"==typeof t&&"String"!=m(t);i&&(n=t,t=null);var o=n.navigator||{},s=o.userAgent||"";t||(t=s);var a,c,u,l,f,y=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(p.toString()),S=i?"Object":"ScriptBridgingProxyObject",O=i?"Object":"Environment",w=i&&n.java?"JavaPackage":m(n.java),I=i?"Object":"RuntimeObject",R=/\bJava/.test(w)&&n.java,C=R&&m(n.environment)==O,P=R?"a":"α",V=R?"b":"β",_=n.document||{},k=n.operamini||n.opera,M=d.test(M=i&&k?k["[[Class]]"]:m(k))?M:k=null,T=t,D=[],N=null,A=t==s,L=A&&k&&"function"==typeof k.version&&k.version(),x=b([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,n){return e||RegExp("\\b"+(n.pattern||g(n))+"\\b","i").exec(t)&&(n.label||n)}),j=function(e){return b(e,function(e,n){return e||RegExp("\\b"+(n.pattern||g(n))+"\\b","i").exec(t)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=W([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),B=function(e){return b(e,function(e,n,i){return e||(n[U]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+g(i)+"(?:\\b|\\w*\\d)","i").exec(t))&&i})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),F=function(e){return b(e,function(e,n){var i=n.pattern||g(n);return!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=h(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,i,n.label||n)),e})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function W(e){return b(e,function(e,n){var i=n.pattern||g(n);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=h(e[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function H(e){return b(e,function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}if(x&&(x=[x]),/\bAndroid\b/.test(F)&&!U&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=E(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),B&&!U?U=W([B]):B&&U&&(U=U.replace(RegExp("^("+g(B)+")[-_.\\s]","i"),B+" ").replace(RegExp("^("+g(B)+")[-_.]?(\\w)","i"),B+" $2")),(a=/\bGoogle TV\b/.exec(U))&&(U=a[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==j&&/\bOPiOS\b/.test(t)&&D.push("running in Turbo/Uncompressed mode"),"IE"==j&&/\blike iPhone OS\b/.test(t)?(B=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,U=a.product):/^iP/.test(U)?(j||(j="Safari"),F="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==j&&/^Linux\b/i.test(F)?F="Kubuntu":B&&"Google"!=B&&(/Chrome/.test(j)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(F)&&/^Chrome/.test(j)&&/\bVersion\//i.test(t)?(j="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==j?(/\bMobi/i.test(t)||(F="Android",D.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&D.unshift("accelerated")):"UC Browser"==j&&/\bUCWEB\b/.test(t)?D.push("speed mode"):"PaleMoon"==j&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?D.push("identifying as Firefox "+a[1]):"Firefox"==j&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(F||(F="Firefox OS"),U||(U=a[1])):!j||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(j))?(j&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(j=null),(a=U||B||F)&&(U||B||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(j=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:a)+" Browser")):"Electron"==j&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&D.push("Chromium "+a),L||(L=H(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(j),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==x&&parseFloat(L)>3?"WebKit":/\bOpera\b/.test(j)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(x)&&"WebKit"||!x&&/\bMSIE\b/i.test(t)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==x&&/\bPlayStation\b(?! Vita\b)/i.test(j)&&"NetFront")&&(x=[a]),"IE"==j&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(j+=" Mobile",F="Windows Phone "+(/\+$/.test(a)?a:a+".x"),D.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(j="IE Mobile",F="Windows Phone 8.x",D.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=j&&"Trident"==x&&(a=/\brv:([\d.]+)/.exec(t))&&(j&&D.push("identifying as "+j+(L?" "+L:"")),j="IE",L=a[1]),A){if(l="global",f=null!=(u=n)?typeof u[l]:"number",/^(?:boolean|number|string|undefined)$/.test(f)||"object"==f&&!u[l])m(a=n.runtime)==S?(j="Adobe AIR",F=a.flash.system.Capabilities.os):m(a=n.phantom)==I?(j="PhantomJS",L=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof _.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(L=[L,_.documentMode],(a=+a[1]+4)!=L[1]&&(D.push("IE "+L[1]+" mode"),x&&(x[1]=""),L[1]=a),L="IE"==j?String(L[1].toFixed(1)):L[0]):"number"==typeof _.documentMode&&/^(?:Chrome|Firefox)\b/.test(j)&&(D.push("masking as "+j+" "+L),j="IE",L="11.0",x=["Trident"],F="Windows");else if(R&&(T=(a=R.lang.System).getProperty("os.arch"),F=F||a.getProperty("os.name")+" "+a.getProperty("os.version")),C){try{L=n.require("ringo/engine").version.join("."),j="RingoJS"}catch(e){(a=n.system)&&a.global.system==n.system&&(j="Narwhal",F||(F=a[0].os||null))}j||(j="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(a=n.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(D.push("Node "+a.versions.node),j="Electron",L=a.versions.electron):"string"==typeof a.versions.nw&&(D.push("Chromium "+L,"Node "+a.versions.node),j="NW.js",L=a.versions.nw)),j||(j="Node.js",T=a.arch,F=a.platform,L=(L=/[\d.]+/.exec(a.version))?L[0]:null));F=F&&h(F)}if(L&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(A&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(N=/b/i.test(a)?"beta":"alpha",L=L.replace(RegExp(a+"\\+?$"),"")+("beta"==N?V:P)+(/\d+\+?/.exec(a)||"")),"Fennec"==j||"Firefox"==j&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(F))j="Firefox Mobile";else if("Maxthon"==j&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(F=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&D.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(j)&&(!j||U||/Browser|Mobi/.test(j))||"Windows CE"!=F&&!/Mobi/i.test(t))if("IE"==j&&A)try{null===n.external&&D.unshift("platform preview")}catch(e){D.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(a=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||L)?(F=((a=[a,/BB10/.test(t)])[1]?(U=null,B="BlackBerry"):"Device Software")+" "+a[0],L=null):this!=v&&"Wii"!=U&&(A&&k||/Opera/.test(j)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==j&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==j&&(F&&!/^Win/.test(F)&&L>5.5||/\bWindows XP\b/.test(F)&&L>8||8==L&&!/\bTrident\b/.test(t)))&&!d.test(a=e.call(v,t.replace(d,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),d.test(j)?(/\bIE\b/.test(a)&&"Mac OS"==F&&(F=null),a="identify"+a):(a="mask"+a,j=M?h(M.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(F=null),A||(L=null)),x=["Presto"],D.push(a));else j+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==j&&"+"==a[1].slice(-1)?(j="WebKit Nightly",N="alpha",L=a[1].slice(0,-1)):L!=a[1]&&L!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(L=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==x&&(x=["Blink"]),A&&(y||a[1])?(x&&(x[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=x?"27":"28")):(x&&(x[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),x&&(x[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==j&&(!L||parseInt(L)>45)?L=a:"Chrome"==j&&/\bHeadlessChrome/i.test(t)&&D.unshift("headless")),"Opera"==j&&(a=/\bzbov|zvav$/.exec(F))?(j+=" ",D.unshift("desktop mode"),"zvav"==a?(j+="Mini",L=null):j+="Mobile",F=F.replace(RegExp(" *"+a+"$"),"")):"Safari"==j&&/\bChrome\b/.exec(x&&x[1])?(D.unshift("desktop mode"),j="Chrome Mobile",L=null,/\bOS X\b/.test(F)?(B="Apple",F="iOS 4.3+"):F=null):/\bSRWare Iron\b/.test(j)&&!L&&(L=H("Chrome")),L&&0==L.indexOf(a=/[\d.]+$/.exec(F))&&t.indexOf("/"+a+"-")>-1&&(F=E(F.replace(a,""))),F&&-1!=F.indexOf(j)&&!RegExp(j+" OS").test(F)&&(F=F.replace(RegExp(" *"+g(j)+" *"),"")),x&&!/\b(?:Avant|Nook)\b/.test(j)&&(/Browser|Lunascape|Maxthon/.test(j)||"Safari"!=j&&/^iOS/.test(F)&&/\bSafari\b/.test(x[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(j)&&x[1])&&(a=x[x.length-1])&&D.push(a),D.length&&(D=["("+D.join("; ")+")"]),B&&U&&U.indexOf(B)<0&&D.push("on "+B),U&&D.push((/^on /.test(D[D.length-1])?"":"on ")+U),F&&(a=/ ([\d.+]+)$/.exec(F),c=a&&"/"==F.charAt(F.length-a[0].length-1),F={architecture:32,family:a&&!c?F.replace(a[0],""):F,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(T))&&!/\bi686\b/i.test(T)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+a),"")),j&&(/\bWOW64\b/i.test(t)||A&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&D.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==j&&parseFloat(L)>=39&&(F.architecture=64),t||(t=null);var q={};return q.description=t,q.layout=x&&x[0],q.manufacturer=B,q.name=j,q.prerelease=N,q.product=U,q.ua=t,q.version=j&&L,q.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},q.parse=e,q.toString=function(){return this.description||""},q.version&&D.unshift(L),q.name&&D.unshift(j),F&&j&&(F!=String(F).split(" ")[0]||F!=j.split(" ")[0]&&!U)&&D.push(U?"("+F+")":"on "+F),D.length&&(q.description=D.join(" ")),q}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(r.platform=y,define(function(){return y})):o&&s?v(y,function(e,t){o[t]=e}):r.platform=y}).call(this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return l.default}});var i=p(e("./v1.js")),r=p(e("./v3.js")),o=p(e("./v4.js")),s=p(e("./v5.js")),a=p(e("./nil.js")),c=p(e("./version.js")),d=p(e("./validate.js")),u=p(e("./stringify.js")),l=p(e("./parse.js"));function p(e){return e&&e.__esModule?e:{default:e}}},{"./nil.js":11,"./parse.js":12,"./stringify.js":16,"./v1.js":17,"./v3.js":18,"./v4.js":20,"./v5.js":21,"./validate.js":22,"./version.js":23}],10:[function(e,t,n){"use strict";function i(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,t,n,i,o,s){return r((a=r(r(t,e),r(i,s)))<<(c=o)|a>>>32-c,n);var a,c}function s(e,t,n,i,r,s,a){return o(t&n|~t&i,e,t,r,s,a)}function a(e,t,n,i,r,s,a){return o(t&i|n&~i,e,t,r,s,a)}function c(e,t,n,i,r,s,a){return o(t^n^i,e,t,r,s,a)}function d(e,t,n,i,r,s,a){return o(n^(t|~i),e,t,r,s,a)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var u=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length;for(let i=0;i<n;i+=8){const n=e[i>>5]>>>i%32&255,r=parseInt("0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n),16);t.push(r)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[i(t)-1]=t;let n=1732584193,o=-271733879,u=-1732584194,l=271733878;for(let t=0;t<e.length;t+=16){const i=n,p=o,f=u,h=l;n=s(n,o,u,l,e[t],7,-680876936),l=s(l,n,o,u,e[t+1],12,-389564586),u=s(u,l,n,o,e[t+2],17,606105819),o=s(o,u,l,n,e[t+3],22,-1044525330),n=s(n,o,u,l,e[t+4],7,-176418897),l=s(l,n,o,u,e[t+5],12,1200080426),u=s(u,l,n,o,e[t+6],17,-1473231341),o=s(o,u,l,n,e[t+7],22,-45705983),n=s(n,o,u,l,e[t+8],7,1770035416),l=s(l,n,o,u,e[t+9],12,-1958414417),u=s(u,l,n,o,e[t+10],17,-42063),o=s(o,u,l,n,e[t+11],22,-1990404162),n=s(n,o,u,l,e[t+12],7,1804603682),l=s(l,n,o,u,e[t+13],12,-40341101),u=s(u,l,n,o,e[t+14],17,-1502002290),o=s(o,u,l,n,e[t+15],22,1236535329),n=a(n,o,u,l,e[t+1],5,-165796510),l=a(l,n,o,u,e[t+6],9,-1069501632),u=a(u,l,n,o,e[t+11],14,643717713),o=a(o,u,l,n,e[t],20,-373897302),n=a(n,o,u,l,e[t+5],5,-701558691),l=a(l,n,o,u,e[t+10],9,38016083),u=a(u,l,n,o,e[t+15],14,-660478335),o=a(o,u,l,n,e[t+4],20,-405537848),n=a(n,o,u,l,e[t+9],5,568446438),l=a(l,n,o,u,e[t+14],9,-1019803690),u=a(u,l,n,o,e[t+3],14,-187363961),o=a(o,u,l,n,e[t+8],20,1163531501),n=a(n,o,u,l,e[t+13],5,-1444681467),l=a(l,n,o,u,e[t+2],9,-51403784),u=a(u,l,n,o,e[t+7],14,1735328473),o=a(o,u,l,n,e[t+12],20,-1926607734),n=c(n,o,u,l,e[t+5],4,-378558),l=c(l,n,o,u,e[t+8],11,-2022574463),u=c(u,l,n,o,e[t+11],16,1839030562),o=c(o,u,l,n,e[t+14],23,-35309556),n=c(n,o,u,l,e[t+1],4,-1530992060),l=c(l,n,o,u,e[t+4],11,1272893353),u=c(u,l,n,o,e[t+7],16,-155497632),o=c(o,u,l,n,e[t+10],23,-1094730640),n=c(n,o,u,l,e[t+13],4,681279174),l=c(l,n,o,u,e[t],11,-358537222),u=c(u,l,n,o,e[t+3],16,-722521979),o=c(o,u,l,n,e[t+6],23,76029189),n=c(n,o,u,l,e[t+9],4,-640364487),l=c(l,n,o,u,e[t+12],11,-421815835),u=c(u,l,n,o,e[t+15],16,530742520),o=c(o,u,l,n,e[t+2],23,-995338651),n=d(n,o,u,l,e[t],6,-198630844),l=d(l,n,o,u,e[t+7],10,1126891415),u=d(u,l,n,o,e[t+14],15,-1416354905),o=d(o,u,l,n,e[t+5],21,-57434055),n=d(n,o,u,l,e[t+12],6,1700485571),l=d(l,n,o,u,e[t+3],10,-1894986606),u=d(u,l,n,o,e[t+10],15,-1051523),o=d(o,u,l,n,e[t+1],21,-2054922799),n=d(n,o,u,l,e[t+8],6,1873313359),l=d(l,n,o,u,e[t+15],10,-30611744),u=d(u,l,n,o,e[t+6],15,-1560198380),o=d(o,u,l,n,e[t+13],21,1309151649),n=d(n,o,u,l,e[t+4],6,-145523070),l=d(l,n,o,u,e[t+11],10,-1120210379),u=d(u,l,n,o,e[t+2],15,718787259),o=d(o,u,l,n,e[t+9],21,-343485551),n=r(n,i),o=r(o,p),u=r(u,f),l=r(l,h)}return[n,o,u,l]}(function(e){if(0===e.length)return[];const t=8*e.length,n=new Uint32Array(i(t));for(let i=0;i<t;i+=8)n[i>>5]|=(255&e[i/8])<<i%32;return n}(e),8*e.length))};n.default=u},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default="00000000-0000-0000-0000-000000000000"},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,r=(i=e("./validate.js"))&&i.__esModule?i:{default:i};var o=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};n.default=o},{"./validate.js":22}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)};const i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16)},{}],15:[function(e,t,n){"use strict";function i(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:return t^n^i;case 2:return t&n^t&i^n&i;case 3:return t^n^i}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s);for(let t=0;t<s;++t){const n=new Uint32Array(16);for(let i=0;i<16;++i)n[i]=e[64*t+4*i]<<24|e[64*t+4*i+1]<<16|e[64*t+4*i+2]<<8|e[64*t+4*i+3];a[t]=n}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const o=new Uint32Array(80);for(let t=0;t<16;++t)o[t]=a[e][t];for(let e=16;e<80;++e)o[e]=r(o[e-3]^o[e-8]^o[e-14]^o[e-16],1);let s=n[0],c=n[1],d=n[2],u=n[3],l=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),a=r(s,5)+i(n,c,d,u)+l+t[n]+o[e]>>>0;l=u,u=d,d=r(c,30)>>>0,c=s,s=a}n[0]=n[0]+s>>>0,n[1]=n[1]+c>>>0,n[2]=n[2]+d>>>0,n[3]=n[3]+u>>>0,n[4]=n[4]+l>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]};n.default=o},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,r=(i=e("./validate.js"))&&i.__esModule?i:{default:i};const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).substr(1));var s=function(e,t=0){const n=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!(0,r.default)(n))throw TypeError("Stringified UUID is invalid");return n};n.default=s},{"./validate.js":22}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("./rng.js")),r=o(e("./stringify.js"));function o(e){return e&&e.__esModule?e:{default:e}}let s,a,c=0,d=0;var u=function(e,t,n){let o=t&&n||0;const u=t||new Array(16);let l=(e=e||{}).node||s,p=void 0!==e.clockseq?e.clockseq:a;if(null==l||null==p){const t=e.random||(e.rng||i.default)();null==l&&(l=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==p&&(p=a=16383&(t[6]<<8|t[7]))}let f=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:d+1;const v=f-c+(h-d)/1e4;if(v<0&&void 0===e.clockseq&&(p=p+1&16383),(v<0||f>c)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=f,d=h,a=p;const m=(1e4*(268435455&(f+=122192928e5))+h)%4294967296;u[o++]=m>>>24&255,u[o++]=m>>>16&255,u[o++]=m>>>8&255,u[o++]=255&m;const g=f/4294967296*1e4&268435455;u[o++]=g>>>8&255,u[o++]=255&g,u[o++]=g>>>24&15|16,u[o++]=g>>>16&255,u[o++]=p>>>8|128,u[o++]=255&p;for(let e=0;e<6;++e)u[o+e]=l[e];return t||(0,r.default)(u)};n.default=u},{"./rng.js":14,"./stringify.js":16}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("./v35.js")),r=o(e("./md5.js"));function o(e){return e&&e.__esModule?e:{default:e}}var s=(0,i.default)("v3",48,r.default);n.default=s},{"./md5.js":10,"./v35.js":19}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){function o(e,o,s,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=(0,r.default)(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(o),c.set(e,o.length),(c=n(c))[6]=15&c[6]|t,c[8]=63&c[8]|128,s){a=a||0;for(let e=0;e<16;++e)s[a+e]=c[e];return s}return(0,i.default)(c)}try{o.name=e}catch(e){}return o.DNS=s,o.URL=a,o},n.URL=n.DNS=void 0;var i=o(e("./stringify.js")),r=o(e("./parse.js"));function o(e){return e&&e.__esModule?e:{default:e}}const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";n.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";n.URL=a},{"./parse.js":12,"./stringify.js":16}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("./rng.js")),r=o(e("./stringify.js"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,n){const o=(e=e||{}).random||(e.rng||i.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return(0,r.default)(o)};n.default=s},{"./rng.js":14,"./stringify.js":16}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("./v35.js")),r=o(e("./sha1.js"));function o(e){return e&&e.__esModule?e:{default:e}}var s=(0,i.default)("v5",80,r.default);n.default=s},{"./sha1.js":15,"./v35.js":19}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,r=(i=e("./regex.js"))&&i.__esModule?i:{default:i};var o=function(e){return"string"==typeof e&&r.default.test(e)};n.default=o},{"./regex.js":13}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,r=(i=e("./validate.js"))&&i.__esModule?i:{default:i};var o=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)};n.default=o},{"./validate.js":22}],24:[function(e,t,n){function i(){}t.exports=i,i.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var i=3===arguments.length,r=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];return o._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var i=this,r=3===arguments.length,o=r?arguments[1]:void 0,s=r?arguments[2]:arguments[1];return this.on(e,o,function t(){i.off(e,t),s.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,n,i,r;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,i=(r=this.callbacks[t]).length;n<i;n++)r[n]._groupName===e&&(r.splice(n,1),n--,i--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,i=this.callbacks[e];return i?1===arguments.length?(delete this.callbacks[e],this):(-1!==(n=i.indexOf(t))&&(i.splice(n,1),0===i.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,i,r=[].slice.call(arguments,1),o=this.callbacks[e],s=this.getWildcardCallbacks(e);if(o)for(t=0,n=(i=o.slice()).length;t<n&&i[t];++t)i[t].apply(this,r);if(s)for(n=s.length,t=0,n=(i=s.slice()).length;t<n&&i[t];++t)i[t].apply(this,[e].concat(r));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(i=i.concat(this.callbacks[t]));return i}},i.mixin(i)},{}],25:[function(e,t,n){!function(e){"use strict";function n(){}var i=n.prototype,r=e.EventEmitter;function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}i.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp)for(n in t={},i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n]);else t=i[e]||(i[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},i.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,i=this.getListenersAsObject(e),r="object"==typeof t;for(n in i)i.hasOwnProperty(n)&&-1===o(i[n],t)&&i[n].push(r?t:{listener:t,once:!1});return this},i.on=s("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=s("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,t){var n,i,r=this.getListenersAsObject(e);for(i in r)r.hasOwnProperty(i)&&-1!==(n=o(r[i],t))&&r[i].splice(n,1);return this},i.off=s("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)o.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"==typeof r?o.call(this,i,r):s.call(this,i,r));return this},i.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},i.removeAllListeners=s("removeEvent"),i.emitEvent=function(e,t){var n,i,r,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].slice(0),r=0;r<n.length;r++)!0===(i=n[r]).once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},i.trigger=s("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return e.EventEmitter=r,n},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof t&&t.exports?t.exports=n:e.EventEmitter=n}("undefined"!=typeof window?window:this||{})},{}],26:[function(e,t,n){t.exports={author:"OpenVidu",dependencies:{freeice:"2.2.2",hark:"1.2.3",platform:"1.3.6",uuid:"8.3.1","wolfy87-eventemitter":"5.2.9"},description:"OpenVidu Browser",devDependencies:{"@types/node":"14.14.7","@types/platform":"1.3.3",browserify:"17.0.0",grunt:"1.3.0","grunt-cli":"1.3.2","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.0.0","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22",terser:"5.3.8",tsify:"5.0.2",tslint:"6.1.3",typedoc:"0.19.2",typescript:"4.0.5"},license:"Apache-2.0",main:"lib/index.js",name:"openvidu-browser",repository:{type:"git",url:"git://github.com/OpenVidu/openvidu"},scripts:{browserify:"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js",build:"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --lib dom,es5,es2015.promise,scripthost",docs:"./generate-docs.sh"},types:"lib/index.d.ts",version:"2.17.0"}},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./OpenVidu/OpenVidu");window&&(window.OpenVidu=i.OpenVidu)},{"./OpenVidu/OpenVidu":32}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Connection=void 0;var i=e("./Stream"),r=e("../OpenViduInternal/Logger/OpenViduLogger").OpenViduLogger.getInstance(),o=function(){function e(e,t){this.session=e,this.disposed=!1;var n="'Connection' created ";t.role?(this.localOptions=t,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=t,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),r.info(n)}return e.prototype.sendIceCandidate=function(e){r.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,e),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},function(e,t){e&&r.error("Error sending ICE candidate: "+JSON.stringify(e))})},e.prototype.initRemoteStreams=function(e){var t=this;e.forEach(function(e){var n={id:e.id,createdAt:e.createdAt,connection:t,hasAudio:e.hasAudio,hasVideo:e.hasVideo,audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:e.typeOfVideo,frameRate:e.frameRate,videoDimensions:e.videoDimensions?JSON.parse(e.videoDimensions):void 0,filter:e.filter?e.filter:void 0},r=new i.Stream(t.session,n);t.addStream(r)}),r.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},e.prototype.addStream=function(e){e.connection=this,this.stream=e},e.prototype.removeStream=function(e){delete this.stream},e.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},e}();n.Connection=o},{"../OpenViduInternal/Logger/OpenViduLogger":63,"./Stream":35}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventDispatcher=void 0;var i=e("wolfy87-eventemitter"),r=e("../OpenViduInternal/Logger/OpenViduLogger").OpenViduLogger.getInstance(),o=function(){function e(){this.userHandlerArrowHandler=new WeakMap,this.ee=new i}return e.prototype.off=function(e,t){if(t){var n=this.userHandlerArrowHandler.get(t);n&&this.ee.off(e,n),this.userHandlerArrowHandler.delete(t)}else this.ee.removeAllListeners(e);return this},e.prototype.onAux=function(e,t,n){var i=function(e){e?r.info(t,e):r.info(t),n(e)};return this.userHandlerArrowHandler.set(n,i),this.ee.on(e,i),this},e.prototype.onceAux=function(e,t,n){var i=this,o=function(e){e?r.info(t,e):r.info(t),n(e),i.userHandlerArrowHandler.delete(n)};return this.userHandlerArrowHandler.set(n,o),this.ee.once(e,o),this},e}();n.EventDispatcher=o},{"../OpenViduInternal/Logger/OpenViduLogger":63,"wolfy87-eventemitter":25}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Filter=void 0;var i=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),r=e("../OpenViduInternal/Enums/OpenViduError"),o=e("../OpenViduInternal/Logger/OpenViduLogger").OpenViduLogger.getInstance(),s=function(){function e(e,t){this.handlers=new Map,this.type=e,this.options=t}return e.prototype.execMethod=function(e,t){var n=this;return new Promise(function(s,a){var c;if(o.info("Executing filter method to stream "+n.stream.streamId),"string"!=typeof t)try{c=JSON.stringify(t)}catch(e){var d="'params' property must be a JSON formatted object";o.error(d),a(d)}else c=t;n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:e,params:c},function(t,d){if(t)o.error("Error executing filter method for Stream "+n.stream.streamId,t),401===t.code?a(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):a(t);else{o.info("Filter method successfully executed on Stream "+n.stream.streamId);var u=Object.assign({},n.stream.filter);n.stream.filter.lastExecMethod={method:e,params:JSON.parse(c)},n.stream.session.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,u,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,u,"execFilterMethod")]),s()}})})},e.prototype.addEventListener=function(e,t){var n=this;return new Promise(function(i,s){o.info("Adding filter event listener to event "+e+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:e},function(a,c){a?(o.error("Error adding filter event listener to event "+e+"for Stream "+n.stream.streamId,a),401===a.code?s(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):s(a)):(n.handlers.set(e,t),o.info("Filter event listener to event "+e+" successfully applied on Stream "+n.stream.streamId),i())})})},e.prototype.removeEventListener=function(e){var t=this;return new Promise(function(n,i){o.info("Removing filter event listener to event "+e+" to stream "+t.stream.streamId),t.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:t.stream.streamId,eventType:e},function(s,a){s?(o.error("Error removing filter event listener to event "+e+"for Stream "+t.stream.streamId,s),401===s.code?i(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):i(s)):(t.handlers.delete(e),o.info("Filter event listener to event "+e+" successfully removed on Stream "+t.stream.streamId),n())})})},e}();n.Filter=s},{"../OpenViduInternal/Enums/OpenViduError":39,"../OpenViduInternal/Events/StreamPropertyChangedEvent":52,"../OpenViduInternal/Logger/OpenViduLogger":63}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LocalRecorder=void 0;var i,r=e("../OpenViduInternal/Enums/LocalRecorderState"),o=e("../OpenViduInternal/Logger/OpenViduLogger"),s=e("../OpenViduInternal/Utils/Platform"),a=o.OpenViduLogger.getInstance(),c=function(){function e(e){this.stream=e,this.chunks=[],i=s.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=r.LocalRecorderState.READY}return e.prototype.record=function(e){var t=this;return new Promise(function(n,i){try{if("undefined"==typeof MediaRecorder)throw a.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(t.state!==r.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+t.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");a.log("Starting local recording of stream '"+t.stream.streamId+"' of connection '"+t.connectionId+"'");var o={};"function"==typeof MediaRecorder.isTypeSupported?e?(MediaRecorder.isTypeSupported(e)||i(new Error('mimeType "'+e+'" is not supported')),o={mimeType:e}):a.log("No mimeType parameter provided. Using default codecs"):a.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"),t.mediaRecorder=new MediaRecorder(t.stream.getMediaStream(),o),t.mediaRecorder.start(10)}catch(e){i(e)}t.mediaRecorder.ondataavailable=function(e){t.chunks.push(e.data)},t.mediaRecorder.onerror=function(e){a.error("MediaRecorder error: ",e)},t.mediaRecorder.onstart=function(){a.log("MediaRecorder started (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onstop=function(){t.onStopDefault()},t.mediaRecorder.onpause=function(){a.log("MediaRecorder paused (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onresume=function(){a.log("MediaRecorder resumed (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onwarning=function(e){a.log("MediaRecorder warning: "+e)},t.state=r.LocalRecorderState.RECORDING,n()})},e.prototype.stop=function(){var e=this;return new Promise(function(t,n){try{if(e.state===r.LocalRecorderState.READY||e.state===r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' before");e.mediaRecorder.onstop=function(){e.onStopDefault(),t()},e.mediaRecorder.stop()}catch(e){n(e)}})},e.prototype.pause=function(){var e=this;return new Promise(function(t,n){try{e.state!==r.LocalRecorderState.RECORDING&&n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),e.mediaRecorder.pause(),e.state=r.LocalRecorderState.PAUSED,t()}catch(e){n(e)}})},e.prototype.resume=function(){var e=this;return new Promise(function(t,n){try{if(e.state!==r.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.pause()' before");e.mediaRecorder.resume(),e.state=r.LocalRecorderState.RECORDING,t()}catch(e){n(e)}})},e.prototype.preview=function(e){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,i.isSafariBrowser()&&this.videoPreview.setAttribute("playsinline","true"),"string"==typeof e){var t=document.getElementById(e);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=e.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},e.prototype.clean=function(){var e=this,t=function(){delete e.blob,e.chunks=[],delete e.mediaRecorder,e.state=r.LocalRecorderState.READY};this.state===r.LocalRecorderState.RECORDING||this.state===r.LocalRecorderState.PAUSED?this.stop().then(function(){return t()}).catch(function(){return t()}):t()},e.prototype.download=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var e=document.createElement("a");e.style.display="none",document.body.appendChild(e);var t=window.URL.createObjectURL(this.blob);e.href=t,e.download=this.id+".webm",e.click(),window.URL.revokeObjectURL(t),document.body.removeChild(e)},e.prototype.getBlob=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},e.prototype.uploadAsBinary=function(e,t){var n=this;return new Promise(function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"==typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status))},s.send(n.blob)}})},e.prototype.uploadAsMultipartfile=function(e,t){var n=this;return new Promise(function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"==typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}var u=new FormData;u.append("file",n.blob,n.id+".webm"),s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status))},s.send(u)}})},e.prototype.onStopDefault=function(){a.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=r.LocalRecorderState.FINISHED},e}();n.LocalRecorder=c},{"../OpenViduInternal/Enums/LocalRecorderState":38,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/Utils/Platform":66}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OpenVidu=void 0;var i,r=e("./LocalRecorder"),o=e("./Publisher"),s=e("./Session"),a=e("../OpenViduInternal/Events/SessionDisconnectedEvent"),c=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),d=e("../OpenViduInternal/Enums/OpenViduError"),u=e("../OpenViduInternal/Enums/VideoInsertMode"),l=e("../OpenViduInternal/Logger/OpenViduLogger"),p=e("../OpenViduInternal/Utils/Platform"),f=e("../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto"),h=e("../OpenViduInternal/ScreenSharing/Screen-Capturing"),v=e("wolfy87-eventemitter"),m=e("../OpenViduInternal/KurentoUtils/kurento-jsonrpc"),g=e("../../package.json"),b=l.OpenViduLogger.getInstance(),E=function(){function e(){var e=this;this.publishers=[],this.secret="",this.recorder=!1,this.advancedConfiguration={},this.webrtcStatsInterval=0,this.ee=new v,i=p.PlatformUtils.getInstance(),this.libraryVersion=g.version,b.info("'OpenVidu' initialized"),b.info("openvidu-browser version: "+this.libraryVersion),i.isMobileDevice()&&window.addEventListener("orientationchange",function(){e.publishers.forEach(function(t){if(t.stream.isLocalStreamPublished&&t.stream&&t.stream.hasVideo&&t.stream.streamManager.videos[0])var n=0,r=t.stream.videoDimensions.width,o=t.stream.videoDimensions.height,s=setInterval(function(){new Promise(function(e,n){if(i.isIonicIos())e({newWidth:t.stream.streamManager.videos[0].video.videoWidth,newHeight:t.stream.streamManager.videos[0].video.videoHeight});else{var r=t.stream.getMediaStream().getVideoTracks()[0].getSettings();e({newWidth:i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?r.width:t.videoReference.videoWidth,newHeight:i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?r.height:t.videoReference.videoHeight})}}).then(function(e){a(r,o,e.newWidth,e.newHeight)})},75),a=function(i,r,o,a){++n>10&&clearTimeout(s),o===i&&a===r||(t.stream.videoDimensions={width:o||0,height:a||0},e.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(t.stream.videoDimensions),reason:"deviceRotated"},function(n,o){n?b.error("Error sending 'streamPropertyChanged' event",n):(e.session.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(e.session,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:r},"deviceRotated")]),t.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(t,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:r},"deviceRotated")]),e.session.sendVideoData(t))}),clearTimeout(s))}})})}return e.prototype.initSession=function(){return this.session=new s.Session(this),this.session},e.prototype.initPublisher=function(e,t,n){var i;i=t&&"function"!=typeof t?{audioSource:void 0!==(i=t).audioSource?i.audioSource:void 0,frameRate:"undefined"!=typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:void 0!==i.frameRate?i.frameRate:void 0,insertMode:void 0!==i.insertMode?"string"==typeof i.insertMode?u.VideoInsertMode[i.insertMode]:i.insertMode:u.VideoInsertMode.APPEND,mirror:void 0===i.mirror||i.mirror,publishAudio:void 0===i.publishAudio||i.publishAudio,publishVideo:void 0===i.publishVideo||i.publishVideo,resolution:"undefined"!=typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:void 0!==i.resolution?i.resolution:"640x480",videoSource:void 0!==i.videoSource?i.videoSource:void 0,filter:i.filter}:{insertMode:u.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var r,s=new o.Publisher(e,i,this);return t&&"function"==typeof t?r=t:n&&(r=n),s.initialize().then(function(){void 0!==r&&r(void 0),s.emitEvent("accessAllowed",[])}).catch(function(e){void 0!==r&&r(e),s.emitEvent("accessDenied",[e])}),this.publishers.push(s),s},e.prototype.initPublisherAsync=function(e,t){var n=this;return new Promise(function(i,r){var o,s=function(e){e?r(e):i(o)};o=t?n.initPublisher(e,t,s):n.initPublisher(e,s)})},e.prototype.initLocalRecorder=function(e){return new r.LocalRecorder(e)},e.prototype.checkSystemRequirements=function(){return i.isIPhoneOrIPad()?i.isIOSWithSafari()||i.isIonicIos()?1:0:i.isChromeBrowser()||i.isChromeMobileBrowser()||i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()||i.isOperaBrowser()||i.isOperaMobileBrowser()||i.isEdgeBrowser()||i.isEdgeMobileBrowser()||i.isSafariBrowser()||i.isAndroidBrowser()||i.isElectron()||i.isSamsungBrowser()?1:0},e.prototype.checkScreenSharingCapabilities=function(){return i.canScreenShare()},e.prototype.getDevices=function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){var n,r=[];i.isIonicAndroid()&&"undefined"!=typeof cordova&&(null===(n=null===cordova||void 0===cordova?void 0:cordova.plugins)||void 0===n?void 0:n.EnumerateDevicesPlugin)?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function(n){var i=[],o=[],s=[];i=n.filter(function(e){return"audioinput"===e.kind}),o=t.filter(function(e){return"videoinput"===e.kind}),s=t.filter(function(e){return"audioinput"===e.kind}),o.forEach(function(e,t){if(e.label)r.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";n=0===t?"Front Camera":1===t?"Back Camera":"Unknown Camera",r.push({kind:e.kind,deviceId:e.deviceId,label:n})}}),s.forEach(function(e,t){if(e.label)r.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";switch(t){case 0:n="Default";break;case 1:var o=i.filter(function(e){return e.label.includes("Built")})[0];n=o?o.label:"Built-in Microphone";break;case 2:var s=i.filter(function(e){return e.label.includes("Wired")})[0];n=s?s.label:"Headset earpiece";break;case 3:var a=i.filter(function(e){return e.label.includes("Bluetooth")})[0];n=a?a.label:"Wireless";break;default:n="Unknown Microphone"}r.push({kind:e.kind,deviceId:e.deviceId,label:n})}}),e(r)}):(t.forEach(function(e){"audioinput"!==e.kind&&"videoinput"!==e.kind||r.push({kind:e.kind,deviceId:e.deviceId,label:e.label})}),e(r))}).catch(function(e){b.error("Error getting devices",e),t(e)})})},e.prototype.getUserMedia=function(e){var t=this;return new Promise(function(n,r){var o=function(e,i){var o={audio:void 0===i.audio||i.audio,video:!1};navigator.mediaDevices.getUserMedia(o).then(function(t){e.addTrack(t.getAudioTracks()[0]),n(e)}).catch(function(n){e.getAudioTracks().forEach(function(e){e.stop()}),e.getVideoTracks().forEach(function(e){e.stop()}),r(t.generateAudioDeviceError(n,o))})};t.generateMediaConstraints(e).then(function(s){var a,c;if(s.videoTrack&&s.audioTrack||s.audioTrack&&!1===(null===(a=s.constraints)||void 0===a?void 0:a.video)||s.videoTrack&&!1===(null===(c=s.constraints)||void 0===c?void 0:c.audio))n(t.addAlreadyProvidedTracks(s,new MediaStream));else{s.videoTrack&&delete s.constraints.video,s.audioTrack&&delete s.constraints.audio;var u=!1;if("string"==typeof e.videoSource&&("screen"===e.videoSource||"window"===e.videoSource||i.isElectron()&&e.videoSource.startsWith("screen:"))&&(u=!s.audioTrack&&null!==e.audioSource&&!1!==e.audioSource,navigator.mediaDevices.getDisplayMedia&&!i.isElectron()))return void navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){t.addAlreadyProvidedTracks(s,e),u?o(e,s.constraints):n(e)}).catch(function(e){var t=d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,n=e.toString();r(new d.OpenViduError(t,n))});var l=u?{video:s.constraints.video}:s.constraints;navigator.mediaDevices.getUserMedia(l).then(function(e){t.addAlreadyProvidedTracks(s,e),u?o(e,s.constraints):n(e)}).catch(function(t){var n,i=t.toString();n="screen"!==e.videoSource?d.OpenViduErrorName.DEVICE_ACCESS_DENIED:d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,r(new d.OpenViduError(n,i))})}}).catch(function(e){r(e)})})},e.prototype.enableProdMode=function(){b.enableProdMode()},e.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},e.prototype.generateMediaConstraints=function(e){var t=this;return new Promise(function(n,i){var r={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},o=e.audioSource,s=e.videoSource;if(null!==o&&!1!==o||(r.constraints.audio=!1),null!==s&&!1!==s||(r.constraints.video=!1),!1===r.constraints.audio&&!1===r.constraints.video&&i(new d.OpenViduError(d.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")),"undefined"!=typeof MediaStreamTrack&&o instanceof MediaStreamTrack&&(r.audioTrack=o),"undefined"!=typeof MediaStreamTrack&&s instanceof MediaStreamTrack&&(r.videoTrack=s),void 0===o&&(r.constraints.audio=!0),void 0===s&&(r.constraints.video={width:{ideal:640},height:{ideal:480}}),null!==s&&!1!==s){if(e.resolution){var a=e.resolution.toLowerCase().split("x"),c=Number(a[0]),u=Number(a[1]);r.constraints.video={width:{ideal:c},height:{ideal:u}}}e.frameRate&&(r.constraints.video.frameRate={ideal:e.frameRate})}t.configureDeviceIdOrScreensharing(r,e,n,i),n(r)})},e.prototype.startWs=function(e){var t={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session)}};this.jsonRpcClient=new m.clients.JsonRpcClient(t)},e.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},e.prototype.sendRequest=function(e,t,n){t&&t instanceof Function&&(n=t,t={}),b.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(t)+"}"),this.jsonRpcClient.send(e,t,n)},e.prototype.getWsUri=function(){return this.wsUri},e.prototype.getSecret=function(){return this.secret},e.prototype.getRecorder=function(){return this.recorder},e.prototype.generateAudioDeviceError=function(e,t){var n,i;switch("Error"===e.name&&(e.name=e.constructor.name),e.name.toLowerCase()){case"notfounderror":return n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i=e.toString(),new d.OpenViduError(n,i);case"notallowederror":return n=d.OpenViduErrorName.DEVICE_ACCESS_DENIED,i=e.toString(),new d.OpenViduError(n,i);case"overconstrainederror":return"deviceid"===e.constraint.toLowerCase()?(n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i="Audio input device with deviceId '"+t.audio.deviceId.exact+"' not found"):(n=d.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new d.OpenViduError(n,i);case"notreadableerror":return n=d.OpenViduErrorName.DEVICE_ALREADY_IN_USE,i=e.toString(),new d.OpenViduError(n,i);default:return new d.OpenViduError(d.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},e.prototype.addAlreadyProvidedTracks=function(e,t){return e.videoTrack&&t.addTrack(e.videoTrack),e.audioTrack&&t.addTrack(e.audioTrack),t},e.prototype.configureDeviceIdOrScreensharing=function(e,t,n,r){var o=this,s=t.audioSource,a=t.videoSource;if("string"==typeof s&&(e.constraints.audio={deviceId:{exact:s}}),"string"==typeof a)if(this.isScreenShare(a))if(this.checkScreenSharingCapabilities())if(i.isElectron()){var c=a,u=c.substr(c.indexOf("screen:")+"screen:".length);e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u}},n(e)}else{if(this.advancedConfiguration.screenShareChromeExtension&&!i.isFirefoxBrowser()&&!i.isFirefoxMobileBrowser()&&!navigator.mediaDevices.getDisplayMedia)return void h.getScreenConstraints(function(t,i){if(t||i.mandatory&&"screen"===i.mandatory.chromeMediaSource){if("permission-denied"!==t&&"PermissionDeniedError"!==t){var s=o.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();return void h.getChromeExtensionStatus(s,function(e){if("installed-disabled"===e){var t=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");b.error(t),r(t)}if("not-installed"===e){var n=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,o.advancedConfiguration.screenShareChromeExtension);b.error(n),r(n)}})}var a=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");b.error(a),r(a)}else e.constraints.video=i,n(e)});if(!navigator.mediaDevices.getDisplayMedia){var l=i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?t.videoSource:void 0;return void f.getScreenId(l,function(t,i,s){if(t)if("not-installed"===t){var a=o.advancedConfiguration.screenShareChromeExtension?o.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,a);b.error(c),r(c)}else if("installed-disabled"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");b.error(c),r(c)}else if("permission-denied"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");b.error(c),r(c)}else{c=new d.OpenViduError(d.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");b.error(c),b.error(t),r(c)}else e.constraints.video=s.video,n(e)})}n(e)}else{var p=new d.OpenViduError(d.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+i.getName()+" "+i.getVersion());b.error(p),r(p)}else this.setVideoSource(e,a)},e.prototype.setVideoSource=function(e,t){e.constraints.video||(e.constraints.video={}),e.constraints.video.deviceId={exact:t}},e.prototype.disconnectCallback=function(){b.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},e.prototype.reconnectingCallback=function(){b.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},e.prototype.reconnectedCallback=function(){var e=this;if(b.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},function(t,n){t?(b.error(t),b.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"),e.session.onLostConnection("networkDisconnect"),e.jsonRpcClient.close(4101,"Reconnection fault")):(e.jsonRpcClient.resetPing(),e.session.onRecoveredConnection())});else{b.warn("There was no previous connection when running reconnection callback");var t=new a.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[t]),t.callDefaultBehavior()}else alert("Connection error. Please reload page.")},e.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof s.Session||(b.warn("Session instance not found"),!1)},e.prototype.isScreenShare=function(e){return"screen"===e||"window"===e||i.isElectron()&&e.startsWith("screen:")},e}();n.OpenVidu=E},{"../../package.json":26,"../OpenViduInternal/Enums/OpenViduError":39,"../OpenViduInternal/Enums/VideoInsertMode":40,"../OpenViduInternal/Events/SessionDisconnectedEvent":48,"../OpenViduInternal/Events/StreamPropertyChangedEvent":52,"../OpenViduInternal/KurentoUtils/kurento-jsonrpc":59,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/ScreenSharing/Screen-Capturing":65,"../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto":64,"../OpenViduInternal/Utils/Platform":66,"./LocalRecorder":31,"./Publisher":33,"./Session":34,"wolfy87-eventemitter":25}],33:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Publisher=void 0;var o,s=e("./Session"),a=e("./Stream"),c=e("./StreamManager"),d=e("../OpenViduInternal/Events/StreamEvent"),u=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),l=e("../OpenViduInternal/Events/VideoElementEvent"),p=e("../OpenViduInternal/Enums/OpenViduError"),f=e("../OpenViduInternal/Logger/OpenViduLogger"),h=e("../OpenViduInternal/Utils/Platform"),v=f.OpenViduLogger.getInstance(),m=function(e){function t(t,n,i){var r=e.call(this,new a.Stream(i.session?i.session:new s.Session(i),{publisherProperties:n,mediaConstraints:{}}),t)||this;return r.accessAllowed=!1,r.isSubscribedToRemote=!1,r.accessDenied=!1,o=h.PlatformUtils.getInstance(),r.properties=n,r.openvidu=i,r.stream.ee.on("local-stream-destroyed",function(e){r.stream.isLocalStreamPublished=!1;var t=new d.StreamEvent(!0,r,"streamDestroyed",r.stream,e);r.emitEvent("streamDestroyed",[t]),t.callDefaultBehavior()}),r}return r(t,e),t.prototype.publishAudio=function(e){var t=this;this.stream.audioActive!==e&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getAudioTracks().forEach(function(t){t.enabled=e}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:e,reason:"publishAudio"},function(n,i){n?v.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(t.session,t.stream,"audioActive",e,!e,"publishAudio")]),t.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(t,t.stream,"audioActive",e,!e,"publishAudio")]),t.session.sendVideoData(t.stream.streamManager))}),this.stream.audioActive=e,v.info("'Publisher' has "+(e?"published":"unpublished")+" its audio stream"))},t.prototype.publishVideo=function(e){var t=this;this.stream.videoActive!==e&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getVideoTracks().forEach(function(t){t.enabled=e}),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:e,reason:"publishVideo"},function(n,i){n?v.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(t.session,t.stream,"videoActive",e,!e,"publishVideo")]),t.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(t,t.stream,"videoActive",e,!e,"publishVideo")]),t.session.sendVideoData(t.stream.streamManager))}),this.stream.videoActive=e,v.info("'Publisher' has "+(e?"published":"unpublished")+" its video stream"))},t.prototype.subscribeToRemote=function(e){e=void 0===e||e,this.isSubscribedToRemote=e,this.stream.subscribeToMyRemote(e)},t.prototype.on=function(t,n){var i=this;return e.prototype.on.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new d.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",function(){i.emitEvent("streamCreated",[new d.StreamEvent(!1,i,"streamCreated",i.stream,"")])})),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new l.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.once=function(t,n){var i=this;return e.prototype.once.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new d.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",function(){i.emitEvent("streamCreated",[new d.StreamEvent(!1,i,"streamCreated",i.stream,"")])})),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new l.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.replaceTrack=function(e){var t=this,n=function(){var n,i=t.stream.displayMyRemote()?t.stream.localMediaStreamWhenSubscribedToRemote:t.stream.getMediaStream();n="video"===e.kind?i.getVideoTracks()[0]:i.getAudioTracks()[0],i.removeTrack(n),n.stop(),i.addTrack(e),t.session.sendVideoData(t.stream.streamManager,5,!0,5)};return new Promise(function(i,r){if(t.stream.isLocalStreamPublished){var o=t.stream.getRTCPeerConnection().getSenders(),s=void 0;"video"===e.kind?(s=o.find(function(e){return!!e.track&&"video"===e.track.kind}))||r(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")):"audio"===e.kind?(s=o.find(function(e){return!!e.track&&"audio"===e.track.kind}))||r(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")):r(new Error("Unknown track kind "+e.kind)),s.replaceTrack(e).then(function(){n(),i()}).catch(function(e){r(e)})}else n(),i()})},t.prototype.initialize=function(){var e=this;return new Promise(function(t,n){var i,r={},s={},a=function(t){e.accessDenied=!0,e.accessAllowed=!1,n(t)},c=function(n){if(e.accessAllowed=!0,e.accessDenied=!1,"undefined"!=typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&(n.removeTrack(n.getAudioTracks()[0]),n.addTrack(e.properties.audioSource)),"undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&(n.removeTrack(n.getVideoTracks()[0]),n.addTrack(e.properties.videoSource)),n.getAudioTracks()[0]){var i=void 0!==e.stream.audioActive&&null!==e.stream.audioActive?e.stream.audioActive:!!e.stream.outboundStreamOpts.publisherProperties.publishAudio;n.getAudioTracks()[0].enabled=i}if(n.getVideoTracks()[0]){i=void 0!==e.stream.videoActive&&null!==e.stream.videoActive?e.stream.videoActive:!!e.stream.outboundStreamOpts.publisherProperties.publishVideo;n.getVideoTracks()[0].enabled=i}if(e.initializeVideoReference(n),e.stream.displayMyRemote()||e.stream.updateMediaStreamInVideos(),delete e.firstVideoElement,e.stream.isSendVideo())if(e.stream.isSendScreen())e.videoReference.addEventListener("loadedmetadata",function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.screenShareResizeInterval=setInterval(function(){var t=n.getVideoTracks()[0].getSettings(),i=o.isChromeBrowser()||o.isOperaBrowser()?e.videoReference.videoWidth:t.width,r=o.isChromeBrowser()||o.isOperaBrowser()?e.videoReference.videoHeight:t.height;if(e.stream.isLocalStreamPublished&&(i!==e.stream.videoDimensions.width||r!==e.stream.videoDimensions.height)){var s={width:e.stream.videoDimensions.width,height:e.stream.videoDimensions.height};e.stream.videoDimensions={width:i||0,height:r||0},e.session.openvidu.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:"screenResized"},function(t,n){t?v.error("Error sending 'streamPropertyChanged' event",t):(e.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(e.session,e.stream,"videoDimensions",e.stream.videoDimensions,s,"screenResized")]),e.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,s,"screenResized")]),e.session.sendVideoData(e.stream.streamManager))})}},500),e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])});else if(o.isIonicIos()||o.isSafariBrowser()){e.videoReference.style.display="none",document.body.appendChild(e.videoReference);var r,s=function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]),document.body.removeChild(e.videoReference)};e.videoReference.addEventListener("loadedmetadata",function(){0===e.videoReference.videoWidth?r=setInterval(function(){0!==e.videoReference.videoWidth&&(clearInterval(r),s())},40):s()})}else{var a=e.getVideoDimensions(n),c=a.width,d=a.height;o.isMobileDevice()&&window.innerHeight>window.innerWidth?e.stream.videoDimensions={width:d||0,height:c||0}:e.stream.videoDimensions={width:c||0,height:d||0},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])}else e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]);t()},d=function(t,n){e.clearPermissionDialogTimer(i,1250),e.stream.isSendScreen()&&e.stream.isSendAudio()?(s.audio=n,s.video=!1,i=Date.now(),e.setPermissionDialogTimer(1250),navigator.mediaDevices.getUserMedia(s).then(function(n){e.clearPermissionDialogTimer(i,1250),t.addTrack(n.getAudioTracks()[0]),c(t)}).catch(function(n){e.clearPermissionDialogTimer(i,1250),t.getAudioTracks().forEach(function(e){e.stop()}),t.getVideoTracks().forEach(function(e){e.stop()}),a(e.openvidu.generateAudioDeviceError(n,r))})):c(t)},l=function(t){var n,o;switch(v.error(t),e.clearPermissionDialogTimer(i,1250),"Error"===t.name&&(t.name=t.constructor.name),t.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:r.video}).then(function(e){e.getVideoTracks().forEach(function(e){e.stop()}),n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,o=t.toString(),a(new p.OpenViduError(n,o))}).catch(function(e){n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,o=t.toString(),a(new p.OpenViduError(n,o))});break;case"notallowederror":n=e.stream.isSendScreen()?p.OpenViduErrorName.SCREEN_CAPTURE_DENIED:p.OpenViduErrorName.DEVICE_ACCESS_DENIED,o=t.toString(),a(new p.OpenViduError(n,o));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:r.video}).then(function(e){e.getVideoTracks().forEach(function(e){e.stop()}),"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,o="Audio input device with deviceId '"+r.audio.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,o="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),a(new p.OpenViduError(n,o))}).catch(function(e){"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,o="Video input device with deviceId '"+r.video.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,o="Video input device doesn't support the value passed for constraint '"+t.constraint+"'"),a(new p.OpenViduError(n,o))});break;case"aborterror":case"notreadableerror":n=p.OpenViduErrorName.DEVICE_ALREADY_IN_USE,o=t.toString(),a(new p.OpenViduError(n,o));break;default:n=p.OpenViduErrorName.GENERIC_ERROR,o=t.toString(),a(new p.OpenViduError(n,o))}};e.openvidu.generateMediaConstraints(e.properties).then(function(t){var n,a;if(t.videoTrack&&t.audioTrack||t.audioTrack&&!1===(null===(n=t.constraints)||void 0===n?void 0:n.video)||t.videoTrack&&!1===(null===(a=t.constraints)||void 0===a?void 0:a.audio))c(e.openvidu.addAlreadyProvidedTracks(t,new MediaStream));else{var u={mediaConstraints:r=t.constraints,publisherProperties:e.properties};e.stream.setOutboundStreamOptions(u);var p=void 0===r.audio||r.audio;s.audio=!e.stream.isSendScreen()&&p,s.video=r.video,i=Date.now(),e.setPermissionDialogTimer(1250),e.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!o.isElectron()?navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(n){e.openvidu.addAlreadyProvidedTracks(t,n),d(n,p)}).catch(function(e){l(e)}):navigator.mediaDevices.getUserMedia(s).then(function(n){e.openvidu.addAlreadyProvidedTracks(t,n),d(n,p)}).catch(function(e){l(e)})}}).catch(function(e){a(e)})})},t.prototype.getVideoDimensions=function(e){return e.getVideoTracks()[0].getSettings()},t.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},t.prototype.initializeVideoReference=function(e){this.videoReference=document.createElement("video"),o.isSafariBrowser()&&this.videoReference.setAttribute("playsinline","true"),this.stream.setMediaStream(e),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=e},t.prototype.setPermissionDialogTimer=function(e){var t=this;this.permissionDialogTimeout=setTimeout(function(){t.emitEvent("accessDialogOpened",[])},e)},t.prototype.clearPermissionDialogTimer=function(e,t){clearTimeout(this.permissionDialogTimeout),Date.now()-e>t&&this.emitEvent("accessDialogClosed",[])},t}(c.StreamManager);n.Publisher=m},{"../OpenViduInternal/Enums/OpenViduError":39,"../OpenViduInternal/Events/StreamEvent":50,"../OpenViduInternal/Events/StreamPropertyChangedEvent":52,"../OpenViduInternal/Events/VideoElementEvent":53,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/Utils/Platform":66,"./Session":34,"./Stream":35,"./StreamManager":36}],34:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Session=void 0;var a,c=e("./Connection"),d=e("./Filter"),u=e("./Subscriber"),l=e("./EventDispatcher"),p=e("../OpenViduInternal/Events/ConnectionEvent"),f=e("../OpenViduInternal/Events/FilterEvent"),h=e("../OpenViduInternal/Events/RecordingEvent"),v=e("../OpenViduInternal/Events/SessionDisconnectedEvent"),m=e("../OpenViduInternal/Events/SignalEvent"),g=e("../OpenViduInternal/Events/StreamEvent"),b=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),E=e("../OpenViduInternal/Events/ConnectionPropertyChangedEvent"),y=e("../OpenViduInternal/Events/NetworkQualityLevelChangedEvent"),S=e("../OpenViduInternal/Enums/OpenViduError"),O=e("../OpenViduInternal/Enums/VideoInsertMode"),w=e("../OpenViduInternal/Logger/OpenViduLogger"),I=e("../OpenViduInternal/Utils/Platform"),R=w.OpenViduLogger.getInstance(),C=function(e){function t(t){var n=e.call(this)||this;return n.streamManagers=[],n.remoteStreamsCreated=new Map,n.isFirstIonicIosSubscriber=!0,n.countDownForIonicIosSubscribersActive=!0,n.remoteConnections=new Map,n.startSpeakingEventsEnabled=!1,n.startSpeakingEventsEnabledOnce=!1,n.stopSpeakingEventsEnabled=!1,n.stopSpeakingEventsEnabledOnce=!1,a=I.PlatformUtils.getInstance(),n.openvidu=t,n}return r(t,e),t.prototype.connect=function(e,t){var n=this;return new Promise(function(i,r){n.processToken(e),n.openvidu.checkSystemRequirements()?(n.options={sessionId:n.sessionId,participantId:e,metadata:t?n.stringClientMetadata(t):""},n.connectAux(e).then(function(){i()}).catch(function(e){r(e)})):r(new S.OpenViduError(S.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+a.getName()+" (version "+a.getVersion()+") for "+a.getFamily()+" is not supported in OpenVidu"))})},t.prototype.disconnect=function(){this.leave(!1,"disconnect")},t.prototype.subscribe=function(e,t,n,i){var r,o={};o=n&&"function"!=typeof n?{insertMode:void 0!==n.insertMode?"string"==typeof n.insertMode?O.VideoInsertMode[n.insertMode]:o.insertMode:O.VideoInsertMode.APPEND,subscribeToAudio:void 0===n.subscribeToAudio||n.subscribeToAudio,subscribeToVideo:void 0===n.subscribeToVideo||n.subscribeToVideo}:{insertMode:O.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0},n&&"function"==typeof n?r=n:i&&(r=i),R.info("Subscribing to "+e.connection.connectionId),e.subscribe().then(function(){R.info("Subscribed correctly to "+e.connection.connectionId),void 0!==r&&r(void 0)}).catch(function(e){void 0!==r&&r(e)});var s=new u.Subscriber(e,t,o);return s.targetElement&&e.streamManager.createVideoElement(s.targetElement,o.insertMode),s},t.prototype.subscribeAsync=function(e,t,n){var i=this;return new Promise(function(r,o){var s,a=function(e){e?o(e):r(s)};s=n?i.subscribe(e,t,n,a):i.subscribe(e,t,a)})},t.prototype.unsubscribe=function(e){var t=e.stream.connection.connectionId;R.info("Unsubscribing from "+t),this.openvidu.sendRequest("unsubscribeFromVideo",{sender:e.stream.connection.connectionId},function(n,i){n?R.error("Error unsubscribing from "+t,n):R.info("Unsubscribed correctly from "+t),e.stream.disposeWebRtcPeer(),e.stream.disposeMediaStream()}),e.stream.streamManager.removeAllVideos()},t.prototype.publish=function(e){var t=this;return new Promise(function(n,i){e.session=t,e.stream.session=t,e.stream.publishedOnce?e.initialize().then(function(){t.connection.addStream(e.stream),e.reestablishStreamPlayingEvent(),e.stream.publish().then(function(){t.sendVideoData(e,8,!0,5),n()}).catch(function(e){i(e)})}).catch(function(e){i(e)}):(t.connection.addStream(e.stream),e.stream.publish().then(function(){t.sendVideoData(e,8,!0,5),n()}).catch(function(e){i(e)}))})},t.prototype.unpublish=function(e){var t=e.stream;if(t.connection)if(t.connection===this.connection){R.info("Unpublishing local media ("+t.connection.connectionId+")"),this.openvidu.sendRequest("unpublishVideo",function(e,t){e?R.error(e):R.info("Media unpublished correctly")}),t.disposeWebRtcPeer(),delete t.connection.stream;var n=new g.StreamEvent(!0,e,"streamDestroyed",e.stream,"unpublish");e.emitEvent("streamDestroyed",[n]),n.callDefaultBehavior()}else R.error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method",t);else R.error("The associated Connection object of this Publisher is null",t)},t.prototype.forceDisconnect=function(e){var t=this;return new Promise(function(n,i){R.info("Forcing disconnect for connection "+e.connectionId),t.openvidu.sendRequest("forceDisconnect",{connectionId:e.connectionId},function(t,r){t?(R.error("Error forcing disconnect for Connection "+e.connectionId,t),401===t.code?i(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):i(t)):(R.info("Forcing disconnect correctly for Connection "+e.connectionId),n())})})},t.prototype.forceUnpublish=function(e){var t=this;return new Promise(function(n,i){R.info("Forcing unpublish for stream "+e.streamId),t.openvidu.sendRequest("forceUnpublish",{streamId:e.streamId},function(t,r){t?(R.error("Error forcing unpublish for Stream "+e.streamId,t),401===t.code?i(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):i(t)):(R.info("Forcing unpublish correctly for Stream "+e.streamId),n())})})},t.prototype.signal=function(e){var t=this;return new Promise(function(n,i){var r={};if(e.to&&e.to.length>0){var o=[];e.to.forEach(function(e){e.connectionId&&o.push(e.connectionId)}),r.to=o}else r.to=[];r.data=e.data?e.data:"";var s=e.type?e.type:"signal";s&&"signal:"!==s.substring(0,7)&&(s="signal:"+s),r.type=s,t.openvidu.sendRequest("sendMessage",{message:JSON.stringify(r)},function(e,t){e?i(e):n()})})},t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by 'Session'",n),"publisherStartSpeaking"===t&&(this.startSpeakingEventsEnabled=!0,this.remoteConnections.forEach(function(e){e.stream&&e.stream.hasAudio&&e.stream.enableStartSpeakingEvent()})),"publisherStopSpeaking"===t&&(this.stopSpeakingEventsEnabled=!0,this.remoteConnections.forEach(function(e){e.stream&&e.stream.hasAudio&&e.stream.enableStopSpeakingEvent()})),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by 'Session'",n),"publisherStartSpeaking"===t&&(this.startSpeakingEventsEnabledOnce=!0,this.remoteConnections.forEach(function(e){e.stream&&e.stream.hasAudio&&e.stream.enableOnceStartSpeakingEvent()})),"publisherStopSpeaking"===t&&(this.stopSpeakingEventsEnabledOnce=!0,this.remoteConnections.forEach(function(e){e.stream&&e.stream.hasAudio&&e.stream.enableOnceStopSpeakingEvent()})),this},t.prototype.off=function(t,n){(e.prototype.off.call(this,t,n),"publisherStartSpeaking"===t)&&(0===this.ee.getListeners(t).length&&(this.startSpeakingEventsEnabled=!1,this.remoteConnections.forEach(function(e){e.stream&&e.stream.disableStartSpeakingEvent(!1)})));"publisherStopSpeaking"===t&&(0===this.ee.getListeners(t).length&&(this.stopSpeakingEventsEnabled=!1,this.remoteConnections.forEach(function(e){e.stream&&e.stream.disableStopSpeakingEvent(!1)})));return this},t.prototype.onParticipantJoined=function(e){var t=this;this.getConnection(e.id,"").then(function(t){R.warn("Connection "+e.id+" already exists in connections list")}).catch(function(n){var i=new c.Connection(t,e);t.remoteConnections.set(e.id,i),t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",i,"")])})},t.prototype.onParticipantLeft=function(e){var t=this;this.remoteConnections.size>0&&this.getRemoteConnection(e.connectionId).then(function(n){if(n.stream){var i=n.stream,r=new g.StreamEvent(!0,t,"streamDestroyed",i,e.reason);t.ee.emitEvent("streamDestroyed",[r]),r.callDefaultBehavior(),t.remoteStreamsCreated.delete(i.streamId),0===t.remoteStreamsCreated.size&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0)}t.remoteConnections.delete(n.connectionId),t.ee.emitEvent("connectionDestroyed",[new p.ConnectionEvent(!1,t,"connectionDestroyed",n,e.reason)])}).catch(function(e){R.error(e)})},t.prototype.onParticipantPublished=function(e){var t,n=this,i=function(e){n.remoteConnections.set(e.connectionId,e),n.remoteStreamsCreated.get(e.stream.streamId)||n.ee.emitEvent("streamCreated",[new g.StreamEvent(!1,n,"streamCreated",e.stream,"")]),n.remoteStreamsCreated.set(e.stream.streamId,!0)};this.getRemoteConnection(e.id).then(function(n){t=n,e.metadata=n.data,t.remoteOptions=e,t.initRemoteStreams(e.streams),i(t)}).catch(function(r){t=new c.Connection(n,e),i(t)})},t.prototype.onParticipantUnpublished=function(e){var t=this;e.connectionId===this.connection.connectionId?this.stopPublisherStream(e.reason):this.getRemoteConnection(e.connectionId).then(function(n){var i=new g.StreamEvent(!0,t,"streamDestroyed",n.stream,e.reason);t.ee.emitEvent("streamDestroyed",[i]),i.callDefaultBehavior();var r=n.stream.streamId;t.remoteStreamsCreated.delete(r),0===t.remoteStreamsCreated.size&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0),n.removeStream(r)}).catch(function(e){R.error(e)})},t.prototype.onParticipantEvicted=function(e){e.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,e.reason)},t.prototype.onNewMessage=function(e){var t=this;R.info("New signal: "+JSON.stringify(e));var n=e.type?e.type.replace(/^(signal:)/,""):void 0;e.from?this.getConnection(e.from,"Connection '"+e.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then(function(i){t.ee.emitEvent("signal",[new m.SignalEvent(t,n,e.data,i)]),"signal"!==e.type&&t.ee.emitEvent(e.type,[new m.SignalEvent(t,n,e.data,i)])}).catch(function(e){R.error(e)}):(this.ee.emitEvent("signal",[new m.SignalEvent(this,n,e.data,void 0)]),"signal"!==e.type&&this.ee.emitEvent(e.type,[new m.SignalEvent(this,n,e.data,void 0)]))},t.prototype.onStreamPropertyChanged=function(e){var t=this,n=function(n){if(n.stream&&n.stream.streamId===e.streamId){var i=n.stream,r=void 0;switch(e.property){case"audioActive":r=i.audioActive,e.newValue="true"===e.newValue,i.audioActive=e.newValue;break;case"videoActive":r=i.videoActive,e.newValue="true"===e.newValue,i.videoActive=e.newValue;break;case"videoDimensions":r=i.videoDimensions,e.newValue=JSON.parse(JSON.parse(e.newValue)),i.videoDimensions=e.newValue;break;case"filter":r=i.filter,e.newValue=Object.keys(e.newValue).length>0?e.newValue:void 0,void 0!==e.newValue?(i.filter=new d.Filter(e.newValue.type,e.newValue.options),i.filter.stream=i,e.newValue.lastExecMethod&&(i.filter.lastExecMethod=e.newValue.lastExecMethod)):delete i.filter,e.newValue=i.filter}t.ee.emitEvent("streamPropertyChanged",[new b.StreamPropertyChangedEvent(t,i,e.property,e.newValue,r,e.reason)]),i.streamManager&&i.streamManager.emitEvent("streamPropertyChanged",[new b.StreamPropertyChangedEvent(i.streamManager,i,e.property,e.newValue,r,e.reason)])}else R.error("No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event")};e.connectionId===this.connection.connectionId?n(this.connection):this.getRemoteConnection(e.connectionId).then(function(e){n(e)}).catch(function(e){R.error(e)})},t.prototype.onConnectionPropertyChanged=function(e){var t;switch(e.property){case"role":t=this.connection.role.slice(),this.connection.role=e.newValue,this.connection.localOptions.role=e.newValue;break;case"record":t=this.connection.record,e.newValue="true"===e.newValue,this.connection.record=e.newValue,this.connection.localOptions.record=e.newValue}this.ee.emitEvent("connectionPropertyChanged",[new E.ConnectionPropertyChangedEvent(this,this.connection,e.property,e.newValue,t)])},t.prototype.onNetworkQualityLevelChangedChanged=function(e){var t=this;e.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(this,e.newValue,e.oldValue,this.connection)]):this.getConnection(e.connectionId,"Connection not found for connectionId "+e.connectionId).then(function(n){t.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(t,e.newValue,e.oldValue,n)])}).catch(function(e){R.error(e)})},t.prototype.recvIceCandidate=function(e){var t={candidate:e.candidate,component:e.component,foundation:e.foundation,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,tcpType:e.tcpType,usernameFragment:e.usernameFragment,type:e.type,toJSON:function(){return{candidate:e.candidate}}};this.getConnection(e.senderConnectionId,"Connection not found for connectionId "+e.senderConnectionId+" owning endpoint "+e.endpointName+". Ice candidate will be ignored: "+t).then(function(n){var i=n.stream;i.getWebRtcPeer().addIceCandidate(t).catch(function(t){R.error("Error adding candidate for "+i.streamId+" stream of endpoint "+e.endpointName+": "+t)})}).catch(function(e){R.error(e)})},t.prototype.onSessionClosed=function(e){R.info("Session closed: "+JSON.stringify(e));var t=e.sessionId;void 0!==t?this.ee.emitEvent("session-closed",[{session:t}]):R.warn("Session undefined on session closed",e)},t.prototype.onLostConnection=function(e){R.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,e)},t.prototype.onRecoveredConnection=function(){R.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},t.prototype.onMediaError=function(e){R.error("Media error: "+JSON.stringify(e));var t=e.error;t?this.ee.emitEvent("error-media",[{error:t}]):R.warn("Received undefined media error. Params:",e)},t.prototype.onRecordingStarted=function(e){this.ee.emitEvent("recordingStarted",[new h.RecordingEvent(this,"recordingStarted",e.id,e.name)])},t.prototype.onRecordingStopped=function(e){this.ee.emitEvent("recordingStopped",[new h.RecordingEvent(this,"recordingStopped",e.id,e.name,e.reason)])},t.prototype.onFilterEventDispatched=function(e){var t=this,n=e.connectionId;e.streamId;this.getConnection(n,"No connection found for connectionId "+n).then(function(n){var i;R.info("Filter event dispatched");var r=n.stream;null===(i=r.filter.handlers.get(e.eventType))||void 0===i||i.call(t,new f.FilterEvent(r.filter,e.eventType,e.data))})},t.prototype.reconnectBrokenStreams=function(){R.info("Re-establishing media connections...");var e=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(R.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),e=!0),this.remoteConnections.forEach(function(t){t.stream&&t.stream.streamIceConnectionStateBroken()&&(R.warn("Re-establishing Subscriber "+t.stream.streamId),t.stream.initWebRtcPeerReceive(!0),e=!0)}),e||R.info("There were no media streams in need of a reconnection")},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.leave=function(e,t){var n=this;if(e=!!e,R.info("Leaving Session (forced="+e+")"),this.stopVideoDataIntervals(),this.connection){if(this.connection.disposed||e?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",function(e,t){e&&R.error(e),n.openvidu.closeWs()}),this.stopPublisherStream(t),!this.connection.disposed){var i=new v.SessionDisconnectedEvent(this,t);this.ee.emitEvent("sessionDisconnected",[i]),i.callDefaultBehavior()}}else R.warn("You were not connected to the session "+this.sessionId)},t.prototype.initializeParams=function(e){return{token:e||"",session:this.sessionId,platform:a.getDescription()?a.getDescription():"unknown",metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder()}},t.prototype.sendVideoData=function(e,t,n,i){var r,c,d=this;if(void 0===t&&(t=1),void 0===n&&(n=!1),void 0===i&&(i=1),a.isChromeBrowser()||a.isChromeMobileBrowser()||a.isOperaBrowser()||a.isOperaMobileBrowser()||a.isEdgeBrowser()||a.isElectron()||a.isSafariBrowser()&&!a.isIonicIos()||a.isAndroidBrowser()||a.isSamsungBrowser()||a.isIonicAndroid()||a.isIPhoneOrIPad()&&a.isIOSWithSafari()){var u=function(){return o(d,void 0,void 0,function(){var t,n,i;return s(this,function(r){switch(r.label){case 0:return"connected"!==(t=e.stream.getRTCPeerConnection()).connectionState?[3,2]:[4,t.getStats()];case 1:n=r.sent(),i=[],n.forEach(function(e){"frameWidth"in e&&"frameHeight"in e&&0===i.length&&i.push(e)}),i.length>0&&this.openvidu.sendRequest("videoData",{height:i[0].frameHeight,width:i[0].frameWidth,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},function(e,t){e&&R.error("Error sending 'videoData' event",e)}),r.label=2;case 2:return[2]}})})};if(n){var l=1;this.videoDataInterval=setInterval(function(){l<i?(l++,u()):clearInterval(d.videoDataInterval)},1e3*t)}else this.videoDataTimeout=setTimeout(u,1e3*t)}else a.isFirefoxBrowser()||a.isFirefoxMobileBrowser()||a.isIonicIos()||a.isReactNative()?this.openvidu.sendRequest("videoData",{height:(null===(r=e.stream.videoDimensions)||void 0===r?void 0:r.height)||0,width:(null===(c=e.stream.videoDimensions)||void 0===c?void 0:c.width)||0,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},function(e,t){e&&R.error("Error sending 'videoData' event",e)}):R.error("Browser "+a.getName()+" (version "+a.getVersion()+") for "+a.getFamily()+" is not supported in OpenVidu for Network Quality")},t.prototype.connectAux=function(e){var t=this;return new Promise(function(n,i){t.openvidu.startWs(function(r){if(r)i(r);else{var o=t.initializeParams(e);t.openvidu.sendRequest("joinRoom",o,function(e,r){if(e)i(e);else{t.processJoinRoomResponse(r),t.connection=new c.Connection(t,r);var o={connections:new Array,streams:new Array};r.value.forEach(function(e){var n=new c.Connection(t,e);t.remoteConnections.set(n.connectionId,n),o.connections.push(n),n.stream&&(t.remoteStreamsCreated.set(n.stream.streamId,!0),o.streams.push(n.stream))}),t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",t.connection,"")]),o.connections.forEach(function(e){t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",e,"")])}),o.streams.forEach(function(e){t.ee.emitEvent("streamCreated",[new g.StreamEvent(!1,t,"streamCreated",e,"")])}),n()}})}})})},t.prototype.stopPublisherStream=function(e){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[e]))},t.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},t.prototype.stringClientMetadata=function(e){return"string"!=typeof e?JSON.stringify(e):e},t.prototype.getConnection=function(e,t){var n=this;return new Promise(function(i,r){var o=n.remoteConnections.get(e);o?i(o):n.connection.connectionId===e?i(n.connection):r(new S.OpenViduError(S.OpenViduErrorName.GENERIC_ERROR,t))})},t.prototype.getRemoteConnection=function(e){var t=this;return new Promise(function(n,i){var r=t.remoteConnections.get(e);if(r)n(r);else{var o="Remote connection "+e+" unknown when 'onParticipantLeft'. Existing remote connections: "+JSON.stringify(t.remoteConnections.keys());i(new S.OpenViduError(S.OpenViduErrorName.GENERIC_ERROR,o))}})},t.prototype.processToken=function(e){var t=e.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]},i=e.split("?"),r=decodeURI(i[1]).split("&").map(function(e){return e.split("=")}).reduce(function(e,t){var n=t[0],i=t[1];return e[n]=i,e},{});this.sessionId=r.sessionId;var o=r.secret,s=r.recorder,a=r.webrtcStatsInterval;o&&(this.openvidu.secret=o),s&&(this.openvidu.recorder=!0),a&&(this.openvidu.webrtcStatsInterval=+a),this.openvidu.wsUri="wss://"+n.host+"/openvidu",this.openvidu.httpUri="https://"+n.host}else R.error('Token "'+e+'" is not valid')},t.prototype.processJoinRoomResponse=function(e){if(this.sessionId=e.session,null!=e.coturnIp&&null!=e.turnUsername&&null!=e.turnCredential){var t="stun:"+e.coturnIp+":3478",n="turn:"+e.coturnIp+":3478",i=n+"?transport=tcp";this.openvidu.iceServers=[{urls:[t]},{urls:[n,i],username:e.turnUsername,credential:e.turnCredential}],R.log("STUN/TURN server IP: "+e.coturnIp),R.log("TURN temp credentials ["+e.turnUsername+":"+e.turnCredential+"]")}this.openvidu.role=e.role,this.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==this.openvidu.role,forceUnpublish:"MODERATOR"===this.openvidu.role,forceDisconnect:"MODERATOR"===this.openvidu.role},R.info("openvidu-server version: "+e.version),e.version!==this.openvidu.libraryVersion&&R.warn("OpenVidu Server ("+e.version+") and OpenVidu Browser ("+this.openvidu.libraryVersion+") versions do NOT match. There may be incompatibilities")},t}(l.EventDispatcher);n.Session=C},{"../OpenViduInternal/Enums/OpenViduError":39,"../OpenViduInternal/Enums/VideoInsertMode":40,"../OpenViduInternal/Events/ConnectionEvent":41,"../OpenViduInternal/Events/ConnectionPropertyChangedEvent":42,"../OpenViduInternal/Events/FilterEvent":44,"../OpenViduInternal/Events/NetworkQualityLevelChangedEvent":45,"../OpenViduInternal/Events/RecordingEvent":47,"../OpenViduInternal/Events/SessionDisconnectedEvent":48,"../OpenViduInternal/Events/SignalEvent":49,"../OpenViduInternal/Events/StreamEvent":50,"../OpenViduInternal/Events/StreamPropertyChangedEvent":52,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/Utils/Platform":66,"./Connection":28,"./EventDispatcher":29,"./Filter":30,"./Subscriber":37}],35:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Stream=void 0;var o,s=e("./Filter"),a=e("./Subscriber"),c=e("./EventDispatcher"),d=e("../OpenViduInternal/WebRtcPeer/WebRtcPeer"),u=e("../OpenViduInternal/WebRtcStats/WebRtcStats"),l=e("../OpenViduInternal/Events/PublisherSpeakingEvent"),p=e("../OpenViduInternal/Events/StreamManagerEvent"),f=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),h=e("../OpenViduInternal/Enums/OpenViduError"),v=e("../OpenViduInternal/Logger/OpenViduLogger"),m=e("../OpenViduInternal/Utils/Platform"),g=e("hark"),b=v.OpenViduLogger.getInstance(),E=function(e){function t(t,n){var i=e.call(this)||this;return i.isSubscribeToRemote=!1,i.isLocalStreamReadyToPublish=!1,i.isLocalStreamPublished=!1,i.publishedOnce=!1,i.publisherStartSpeakingEventEnabled=!1,i.publisherStartSpeakingEventEnabledOnce=!1,i.publisherStopSpeakingEventEnabled=!1,i.publisherStopSpeakingEventEnabledOnce=!1,i.volumeChangeEventEnabled=!1,i.volumeChangeEventEnabledOnce=!1,o=m.PlatformUtils.getInstance(),i.session=t,n.hasOwnProperty("id")?(i.inboundStreamOpts=n,i.streamId=i.inboundStreamOpts.id,i.creationTime=i.inboundStreamOpts.createdAt,i.hasAudio=i.inboundStreamOpts.hasAudio,i.hasVideo=i.inboundStreamOpts.hasVideo,i.hasAudio&&(i.audioActive=i.inboundStreamOpts.audioActive),i.hasVideo&&(i.videoActive=i.inboundStreamOpts.videoActive,i.typeOfVideo=i.inboundStreamOpts.typeOfVideo?i.inboundStreamOpts.typeOfVideo:void 0,i.frameRate=-1===i.inboundStreamOpts.frameRate?void 0:i.inboundStreamOpts.frameRate,i.videoDimensions=i.inboundStreamOpts.videoDimensions),i.inboundStreamOpts.filter&&Object.keys(i.inboundStreamOpts.filter).length>0&&(i.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(i.inboundStreamOpts.filter.lastExecMethod).length&&delete i.inboundStreamOpts.filter.lastExecMethod,i.filter=i.inboundStreamOpts.filter)):(i.outboundStreamOpts=n,i.hasAudio=i.isSendAudio(),i.hasVideo=i.isSendVideo(),i.hasAudio&&(i.audioActive=!!i.outboundStreamOpts.publisherProperties.publishAudio),i.hasVideo&&(i.videoActive=!!i.outboundStreamOpts.publisherProperties.publishVideo,i.frameRate=i.outboundStreamOpts.publisherProperties.frameRate,"undefined"!=typeof MediaStreamTrack&&i.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?i.typeOfVideo="CUSTOM":i.typeOfVideo=i.isSendScreen()?"SCREEN":"CAMERA"),i.outboundStreamOpts.publisherProperties.filter&&(i.filter=i.outboundStreamOpts.publisherProperties.filter)),i.ee.on("mediastream-updated",function(){i.streamManager.updateMediaStream(i.mediaStream),b.debug("Video srcObject ["+i.mediaStream+"] updated in stream ["+i.streamId+"]")}),i}return r(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by stream '"+this.streamId+"'",n),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by stream '"+this.streamId+"'",n),this},t.prototype.off=function(t,n){return e.prototype.off.call(this,t,n),this},t.prototype.applyFilter=function(e,t){var n=this;return new Promise(function(i,r){b.info("Applying filter to stream "+n.streamId),"string"!=typeof(t=t||{})&&(t=JSON.stringify(t)),n.session.openvidu.sendRequest("applyFilter",{streamId:n.streamId,type:e,options:t},function(o,a){if(o)b.error("Error applying filter for Stream "+n.streamId,o),401===o.code?r(new h.OpenViduError(h.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):r(o);else{b.info("Filter successfully applied on Stream "+n.streamId);var c=n.filter;n.filter=new s.Filter(e,t),n.filter.stream=n,n.session.emitEvent("streamPropertyChanged",[new f.StreamPropertyChangedEvent(n.session,n,"filter",n.filter,c,"applyFilter")]),n.streamManager.emitEvent("streamPropertyChanged",[new f.StreamPropertyChangedEvent(n.streamManager,n,"filter",n.filter,c,"applyFilter")]),i(n.filter)}})})},t.prototype.removeFilter=function(){var e=this;return new Promise(function(t,n){b.info("Removing filter of stream "+e.streamId),e.session.openvidu.sendRequest("removeFilter",{streamId:e.streamId},function(i,r){if(i)b.error("Error removing filter for Stream "+e.streamId,i),401===i.code?n(new h.OpenViduError(h.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(i);else{b.info("Filter successfully removed from Stream "+e.streamId);var o=e.filter;delete e.filter,e.session.emitEvent("streamPropertyChanged",[new f.StreamPropertyChangedEvent(e.session,e,"filter",e.filter,o,"applyFilter")]),e.streamManager.emitEvent("streamPropertyChanged",[new f.StreamPropertyChangedEvent(e.streamManager,e,"filter",e.filter,o,"applyFilter")]),t()}})})},t.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},t.prototype.getMediaStream=function(){return this.mediaStream},t.prototype.setMediaStream=function(e){this.mediaStream=e},t.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},t.prototype.getWebRtcPeer=function(){return this.webRtcPeer},t.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},t.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},t.prototype.subscribe=function(){var e=this;return new Promise(function(t,n){e.initWebRtcPeerReceive(!1).then(function(){t()}).catch(function(e){n(e)})})},t.prototype.publish=function(){var e=this;return new Promise(function(t,n){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then(function(){t()}).catch(function(e){n(e)}):e.ee.once("stream-ready-to-publish",function(){e.publish().then(function(){t()}).catch(function(e){n(e)})})})},t.prototype.disposeWebRtcPeer=function(){this.webRtcPeer&&(this.webRtcPeer.dispose(),this.stopWebRtcStats()),b.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"WebRTCPeer from 'Stream' with id ["+this.streamId+"] is now closed")},t.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach(function(e){e.stop()}),this.mediaStream.getVideoTracks().forEach(function(e){e.stop()}),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function(e){e.stop()}),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function(e){e.stop()}),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),b.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed")},t.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},t.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},t.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},t.prototype.isSendScreen=function(){var e="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return o.isElectron()&&(e="string"==typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&e},t.prototype.enableStartSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabled||(this.publisherStartSpeakingEventEnabled=!0,this.speechEvent.on("speaking",function(){e.session.emitEvent("publisherStartSpeaking",[new l.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.publisherStartSpeakingEventEnabledOnce=!1}))},t.prototype.enableOnceStartSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabledOnce||(this.publisherStartSpeakingEventEnabledOnce=!0,this.speechEvent.once("speaking",function(){e.publisherStartSpeakingEventEnabledOnce&&e.session.emitEvent("publisherStartSpeaking",[new l.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.disableStartSpeakingEvent(!0)}))},t.prototype.disableStartSpeakingEvent=function(e){if(this.speechEvent){if(this.publisherStartSpeakingEventEnabledOnce=!1,e){if(this.publisherStartSpeakingEventEnabled)return}else this.publisherStartSpeakingEventEnabled=!1;this.volumeChangeEventEnabled||this.volumeChangeEventEnabledOnce||this.publisherStopSpeakingEventEnabled||this.publisherStopSpeakingEventEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.enableStopSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStopSpeakingEventEnabled||(this.publisherStopSpeakingEventEnabled=!0,this.speechEvent.on("stopped_speaking",function(){e.session.emitEvent("publisherStopSpeaking",[new l.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.publisherStopSpeakingEventEnabledOnce=!1}))},t.prototype.enableOnceStopSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStopSpeakingEventEnabledOnce||(this.publisherStopSpeakingEventEnabledOnce=!0,this.speechEvent.once("stopped_speaking",function(){e.publisherStopSpeakingEventEnabledOnce&&e.session.emitEvent("publisherStopSpeaking",[new l.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.disableStopSpeakingEvent(!0)}))},t.prototype.disableStopSpeakingEvent=function(e){if(this.speechEvent){if(this.publisherStopSpeakingEventEnabledOnce=!1,e){if(this.publisherStopSpeakingEventEnabled)return}else this.publisherStopSpeakingEventEnabled=!1;this.volumeChangeEventEnabled||this.volumeChangeEventEnabledOnce||this.publisherStartSpeakingEventEnabled||this.publisherStartSpeakingEventEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.enableVolumeChangeEvent=function(e){var t=this;this.setSpeechEventIfNotExists()?this.volumeChangeEventEnabled&&!e||(this.volumeChangeEventEnabled=!0,this.speechEvent.on("volume_change",function(e){var n={newValue:e,oldValue:t.speechEvent.oldVolumeValue};t.speechEvent.oldVolumeValue=e,t.streamManager.emitEvent("streamAudioVolumeChange",[new p.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",n)])})):this.volumeChangeEventEnabled=!0},t.prototype.enableOnceVolumeChangeEvent=function(e){var t=this;this.setSpeechEventIfNotExists()?this.volumeChangeEventEnabledOnce&&!e||(this.volumeChangeEventEnabledOnce=!0,this.speechEvent.once("volume_change",function(e){var n={newValue:e,oldValue:t.speechEvent.oldVolumeValue};t.speechEvent.oldVolumeValue=e,t.disableVolumeChangeEvent(!0),t.streamManager.emitEvent("streamAudioVolumeChange",[new p.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",n)])})):this.volumeChangeEventEnabledOnce=!0},t.prototype.disableVolumeChangeEvent=function(e){if(this.speechEvent){if(this.volumeChangeEventEnabledOnce=!1,e){if(this.volumeChangeEventEnabled)return}else this.volumeChangeEventEnabled=!1;this.publisherStartSpeakingEventEnabled||this.publisherStartSpeakingEventEnabledOnce||this.publisherStopSpeakingEventEnabled||this.publisherStopSpeakingEventEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},t.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise(function(t,n){e.webRtcStats.getSelectedIceCandidateInfo().then(function(e){return t(e)}).catch(function(e){return n(e)})})},t.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},t.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},t.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return b.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '+this.streamId+" will force a reconnection"),!0;var e=this.getRTCPeerConnection().iceConnectionState;return"disconnected"===e||"failed"===e},t.prototype.setSpeechEventIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval="number"==typeof e.interval?e.interval:100,e.threshold="number"==typeof e.threshold?e.threshold:-50,this.speechEvent=g(this.mediaStream,e)}return!0}return!1},t.prototype.initWebRtcPeerSend=function(e){var t=this;return new Promise(function(n,i){e||t.initHarkEvents();var r={audio:t.isSendAudio(),video:t.isSendVideo()},o={mediaStream:t.mediaStream,mediaConstraints:r,onicecandidate:t.connection.sendIceCandidate.bind(t.connection),iceServers:t.getIceServersConf(),simulcast:!1};e&&t.disposeWebRtcPeer(),t.displayMyRemote()?t.webRtcPeer=new d.WebRtcPeerSendrecv(o):t.webRtcPeer=new d.WebRtcPeerSendonly(o),t.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+t.connection.connectionId),t.webRtcPeer.generateOffer().then(function(r){!function(r){b.debug("Sending SDP offer to publish as "+t.streamId,r);var o,s=e?"reconnectStream":"publishVideo";if(e)o={stream:t.streamId};else{var a="";t.isSendVideo()&&(a="undefined"!=typeof MediaStreamTrack&&t.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":t.isSendScreen()?"SCREEN":"CAMERA"),o={doLoopback:t.displayMyRemote()||!1,hasAudio:t.isSendAudio(),hasVideo:t.isSendVideo(),audioActive:t.audioActive,videoActive:t.videoActive,typeOfVideo:a,frameRate:t.frameRate?t.frameRate:-1,videoDimensions:JSON.stringify(t.videoDimensions),filter:t.outboundStreamOpts.publisherProperties.filter}}o.sdpOffer=r,t.session.openvidu.sendRequest(s,o,function(r,o){r?401===r.code?i(new h.OpenViduError(h.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):i("Error on publishVideo: "+JSON.stringify(r)):t.webRtcPeer.processAnswer(o.sdpAnswer,!1).then(function(){t.streamId=o.id,t.creationTime=o.createdAt,t.isLocalStreamPublished=!0,t.publishedOnce=!0,t.displayMyRemote()&&(t.localMediaStreamWhenSubscribedToRemote=t.mediaStream,t.remotePeerSuccessfullyEstablished()),e?t.ee.emitEvent("stream-reconnected-by-publisher",[]):t.ee.emitEvent("stream-created-by-publisher",[]),t.initWebRtcStats(),b.info("'Publisher' ("+t.streamId+") successfully "+(e?"reconnected":"published")+" to session"),n()}).catch(function(e){i(e)})})}(r)}).catch(function(e){i(new Error("(publish) SDP offer error: "+JSON.stringify(e)))})})},t.prototype.initWebRtcPeerReceive=function(e){var t=this;return new Promise(function(n,i){var r={audio:t.inboundStreamOpts.hasAudio,video:t.inboundStreamOpts.hasVideo};b.debug("'Session.subscribe(Stream)' called. Constraints of generate SDP offer",r);var o={onicecandidate:t.connection.sendIceCandidate.bind(t.connection),mediaConstraints:r,iceServers:t.getIceServersConf(),simulcast:!1};t.webRtcPeer=new d.WebRtcPeerRecvonly(o),t.webRtcPeer.addIceConnectionStateChangeListener(t.streamId),t.webRtcPeer.generateOffer().then(function(r){!function(r){b.debug("Sending SDP offer to subscribe to "+t.streamId,r);var o=e?"reconnectStream":"receiveVideoFrom",s={sdpOffer:r};s[e?"stream":"sender"]=t.streamId,t.session.openvidu.sendRequest(o,s,function(r,o){if(r)i(new Error("Error on recvVideoFrom: "+JSON.stringify(r)));else{t.session.isFirstIonicIosSubscriber&&(t.session.isFirstIonicIosSubscriber=!1,setTimeout(function(){t.session.countDownForIonicIosSubscribersActive=!1},400));var s=t.session.countDownForIonicIosSubscribersActive;t.webRtcPeer.processAnswer(o.sdpAnswer,s).then(function(){b.info("'Subscriber' ("+t.streamId+") successfully "+(e?"reconnected":"subscribed")),t.remotePeerSuccessfullyEstablished(),t.initWebRtcStats(),n()}).catch(function(e){i(e)})}})}(r)}).catch(function(e){i(new Error("(subscribe) SDP offer error: "+JSON.stringify(e)))})})},t.prototype.remotePeerSuccessfullyEstablished=function(){var e;this.mediaStream=new MediaStream;for(var t=0,n=this.webRtcPeer.pc.getReceivers();t<n.length;t++)(e=n[t]).track&&this.mediaStream.addTrack(e.track);if(b.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof a.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var i=!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=i}if(this.mediaStream.getVideoTracks()[0]){i=!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=i}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},t.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.streamManager.remote&&(this.session.startSpeakingEventsEnabled&&this.enableStartSpeakingEvent(),this.session.startSpeakingEventsEnabledOnce&&this.enableOnceStartSpeakingEvent(),this.session.stopSpeakingEventsEnabled&&this.enableStopSpeakingEvent(),this.session.stopSpeakingEventsEnabledOnce&&this.enableOnceStopSpeakingEvent()),this.volumeChangeEventEnabled&&this.enableVolumeChangeEvent(!0),this.volumeChangeEventEnabledOnce&&this.enableOnceVolumeChangeEvent(!0))},t.prototype.initWebRtcStats=function(){this.webRtcStats=new u.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},t.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},t.prototype.getIceServersConf=function(){return this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0},t.prototype.gatherStatsForPeer=function(){var e=this;return new Promise(function(t,n){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach(function(t){return t.getStats().then(function(t){t.forEach(function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"outbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesEncoded=t.framesEncoded),n.packetsSent=t.packetsSent,n.bytesSent=t.bytesSent),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableOutgoingBitrate=t.availableOutgoingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,b.log(n)}})})}):e.getRTCPeerConnection().getReceivers().forEach(function(t){return t.getStats().then(function(t){t.forEach(function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"inbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesDecoded=t.framesDecoded),n.packetsReceived=t.packetsReceived,n.packetsLost=t.packetsLost,n.jitter=t.jitter,n.bytesReceived=t.bytesReceived),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableIncomingBitrate=t.availableIncomingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,b.log(n)}})})})})},t.prototype.isReportWanted=function(e){return"inbound-rtp"===e.type&&!this.isLocal()||"outbound-rtp"===e.type&&this.isLocal()||"candidate-pair"===e.type&&e.nominated&&e.bytesSent>0},t}(c.EventDispatcher);n.Stream=E},{"../OpenViduInternal/Enums/OpenViduError":39,"../OpenViduInternal/Events/PublisherSpeakingEvent":46,"../OpenViduInternal/Events/StreamManagerEvent":51,"../OpenViduInternal/Events/StreamPropertyChangedEvent":52,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/Utils/Platform":66,"../OpenViduInternal/WebRtcPeer/WebRtcPeer":67,"../OpenViduInternal/WebRtcStats/WebRtcStats":68,"./EventDispatcher":29,"./Filter":30,"./Subscriber":37,hark:5}],36:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.StreamManager=void 0;var o,s=e("./EventDispatcher"),a=e("../OpenViduInternal/Events/StreamManagerEvent"),c=e("../OpenViduInternal/Events/VideoElementEvent"),d=e("../OpenViduInternal/Enums/VideoInsertMode"),u=e("../OpenViduInternal/Logger/OpenViduLogger"),l=e("../OpenViduInternal/Utils/Platform"),p=u.OpenViduLogger.getInstance(),f=function(e){function t(t,n){var i=e.call(this)||this;if(i.videos=[],i.lazyLaunchVideoElementCreatedEvent=!1,o=l.PlatformUtils.getInstance(),i.stream=t,i.stream.streamManager=i,i.remote=!i.stream.isLocal(),n){var r=void 0;"string"==typeof n?r=document.getElementById(n):n instanceof HTMLElement&&(r=n),r&&(i.firstVideoElement={targetElement:r,video:document.createElement("video"),id:"",canplayListenerAdded:!1},o.isSafariBrowser()&&i.firstVideoElement.video.setAttribute("playsinline","true"),i.targetElement=r,i.element=r)}return i.canPlayListener=function(){i.stream.isLocal()?i.stream.displayMyRemote()?(p.info("Your own remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("remoteVideoPlaying",[new c.VideoElementEvent(i.videos[0].video,i,"remoteVideoPlaying")])):(p.info("Your local 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new c.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])):(p.info("Remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new c.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])),i.ee.emitEvent("streamPlaying",[new a.StreamManagerEvent(i,"streamPlaying",void 0)])},i}return r(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new c.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new a.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new c.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===t&&this.stream.hasAudio&&this.stream.enableVolumeChangeEvent(!1),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new c.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new a.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new c.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===t&&this.stream.hasAudio&&this.stream.enableOnceVolumeChangeEvent(!1),this},t.prototype.off=function(t,n){(e.prototype.off.call(this,t,n),"streamAudioVolumeChange"===t)&&(0===this.ee.getListeners(t).length&&this.stream.disableVolumeChangeEvent(!1));return this},t.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),this.stream.isLocal()&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var t=0,n=this.videos;t<n.length;t++){if(n[t].video===e)return 0}for(var i=1,r=0,o=this.stream.session.streamManagers;r<o.length;r++){if(o[r].disassociateVideo(e)){i=-1;break}}return this.stream.session.streamManagers.forEach(function(t){t.disassociateVideo(e)}),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),p.info("New video element associated to ",this),i},t.prototype.createVideoElement=function(e,t){var n;if("string"==typeof e){if(!(n=document.getElementById(e)))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else{if(!(e instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);n=e}var i=this.createVideo();this.initializeVideoProperties(i);var r=t||d.VideoInsertMode.APPEND;switch(r){case d.VideoInsertMode.AFTER:n.parentNode.insertBefore(i,n.nextSibling);break;case d.VideoInsertMode.APPEND:n.appendChild(i);break;case d.VideoInsertMode.BEFORE:n.parentNode.insertBefore(i,n);break;case d.VideoInsertMode.PREPEND:n.insertBefore(i,n.childNodes[0]);break;case d.VideoInsertMode.REPLACE:n.parentNode.replaceChild(i,n);break;default:r=d.VideoInsertMode.APPEND,n.appendChild(i)}var o={targetElement:n,video:i,insertMode:r,id:i.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(o),this.ee.emitEvent("videoElementCreated",[new c.VideoElementEvent(o.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,i},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var t=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},n="number"==typeof e.interval?e.interval:"number"==typeof t.interval?t.interval:100,i="number"==typeof e.threshold?e.threshold:"number"==typeof t.threshold?t.threshold:-50;this.stream.harkOptions={interval:n,threshold:i},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(n),this.stream.speechEvent.setThreshold(i))},t.prototype.initializeVideoProperties=function(e){this.stream.isLocal()&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,o.isSafariBrowser()&&e.setAttribute("playsinline","true"),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),this.remote||this.stream.displayMyRemote()||(e.muted=!0,"rotateY(180deg)"!==e.style.transform||this.stream.outboundStreamOpts.publisherProperties.mirror?this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e):this.removeMirrorVideo(e))},t.prototype.removeAllVideos=function(){for(var e=this,t=this.stream.session.streamManagers.length-1;t>=0;--t)this.stream.session.streamManagers[t]===this&&this.stream.session.streamManagers.splice(t,1);this.videos.forEach(function(t){t.video&&t.video.removeEventListener&&t.video.removeEventListener("canplay",e.canPlayListener),t.canplayListenerAdded=!1,t.targetElement&&(t.video.parentNode.removeChild(t.video),e.ee.emitEvent("videoElementDestroyed",[new c.VideoElementEvent(t.video,e,"videoElementDestroyed")])),e.removeSrcObject(t),e.videos.filter(function(e){return!e.targetElement})})},t.prototype.disassociateVideo=function(e){for(var t=!1,n=0;n<this.videos.length;n++)if(this.videos[n].video===e){this.videos[n].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(n,1),t=!0,p.info("Video element disassociated from ",this);break}return t},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach(function(t){if(t.video.srcObject=e,o.isIonicIos()){var n=t.video.parentElement,i=t.video;n.replaceChild(i,t.video),t.video=i}})},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(e){o.isIonicIos()||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},t}(s.EventDispatcher);n.StreamManager=f},{"../OpenViduInternal/Enums/VideoInsertMode":40,"../OpenViduInternal/Events/StreamManagerEvent":51,"../OpenViduInternal/Events/VideoElementEvent":53,"../OpenViduInternal/Logger/OpenViduLogger":63,"../OpenViduInternal/Utils/Platform":66,"./EventDispatcher":29}],37:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Subscriber=void 0;var o=e("./StreamManager"),s=e("../OpenViduInternal/Logger/OpenViduLogger").OpenViduLogger.getInstance(),a=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.element=r.targetElement,r.stream=t,r.properties=i,r}return r(t,e),t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach(function(t){t.enabled=e}),this.stream.audioActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach(function(t){t.enabled=e}),this.stream.videoActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t}(o.StreamManager);n.Subscriber=a},{"../OpenViduInternal/Logger/OpenViduLogger":63,"./StreamManager":36}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LocalRecorderState=void 0,function(e){e.READY="READY",e.RECORDING="RECORDING",e.PAUSED="PAUSED",e.FINISHED="FINISHED"}(n.LocalRecorderState||(n.LocalRecorderState={}))},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OpenViduError=n.OpenViduErrorName=void 0,function(e){e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",e.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",e.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",e.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",e.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",e.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",e.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",e.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",e.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",e.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",e.GENERIC_ERROR="GENERIC_ERROR"}(n.OpenViduErrorName||(n.OpenViduErrorName={}));var i=function(){return function(e,t){this.name=e,this.message=t}}();n.OpenViduError=i},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VideoInsertMode=void 0,function(e){e.AFTER="AFTER",e.APPEND="APPEND",e.BEFORE="BEFORE",e.PREPEND="PREPEND",e.REPLACE="REPLACE"}(n.VideoInsertMode||(n.VideoInsertMode={}))},{}],41:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionEvent=void 0;var o=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.connection=r,s.reason=o,s}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.ConnectionEvent=o},{"./Event":43}],42:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionPropertyChangedEvent=void 0;var o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,"connectionPropertyChanged")||this;return s.connection=n,s.changedProperty=i,s.newValue=r,s.oldValue=o,s}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.ConnectionPropertyChangedEvent=o},{"./Event":43}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;var i=function(){function e(e,t,n){this.hasBeenPrevented=!1,this.cancelable=e,this.target=t,this.type=n}return e.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},e.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},e}();n.Event=i},{}],44:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.FilterEvent=void 0;var o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.data=i,r}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.FilterEvent=o},{"./Event":43}],45:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkQualityLevelChangedEvent=void 0;var o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"networkQualityLevelChanged")||this;return o.newValue=n,o.oldValue=i,o.connection=r,o}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.NetworkQualityLevelChangedEvent=o},{"./Event":43}],46:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.PublisherSpeakingEvent=void 0;var o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,n)||this;return o.type=n,o.connection=i,o.streamId=r,o}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.PublisherSpeakingEvent=o},{"./Event":43}],47:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.RecordingEvent=void 0;var o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,n)||this;return s.id=i,r!==i&&(s.name=r),s.reason=o,s}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.RecordingEvent=o},{"./Event":43}],48:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.SessionDisconnectedEvent=void 0;var o=e("./Event"),s=e("../Logger/OpenViduLogger").OpenViduLogger.getInstance(),a=function(e){function t(t,n){var i=e.call(this,!0,t,"sessionDisconnected")||this;return i.reason=n,i}return r(t,e),t.prototype.callDefaultBehavior=function(){s.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;e.remoteConnections.forEach(function(t){var n,i,r,o,s,a,c,d,u=t.connectionId;if(null===(n=e.remoteConnections.get(u))||void 0===n?void 0:n.stream){null===(i=e.remoteConnections.get(u))||void 0===i||i.stream.disposeWebRtcPeer(),null===(r=e.remoteConnections.get(u))||void 0===r||r.stream.disposeMediaStream(),(null===(o=e.remoteConnections.get(u))||void 0===o?void 0:o.stream.streamManager)&&(null===(s=e.remoteConnections.get(u))||void 0===s||s.stream.streamManager.removeAllVideos());var l=null===(c=null===(a=e.remoteConnections.get(u))||void 0===a?void 0:a.stream)||void 0===c?void 0:c.streamId;l&&e.remoteStreamsCreated.delete(l),null===(d=e.remoteConnections.get(u))||void 0===d||d.dispose()}e.remoteConnections.delete(u)})},t}(o.Event);n.SessionDisconnectedEvent=a},{"../Logger/OpenViduLogger":63,"./Event":43}],49:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.SignalEvent=void 0;var o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"signal")||this;return n&&(o.type="signal:"+n),o.data=i,o.from=r,o}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.SignalEvent=o},{"./Event":43}],50:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.StreamEvent=void 0;var o=e("./Event"),s=e("../../OpenVidu/Publisher"),a=e("../../OpenVidu/Session"),c=e("../Logger/OpenViduLogger").OpenViduLogger.getInstance(),d=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.stream=r,s.reason=o,s}return r(t,e),t.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof a.Session)c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof s.Publisher){c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var e=this.target.openvidu.publishers,t=0;t<e.length;t++)if(e[t]===this.target){e.splice(t,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var n=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(n&&n.remoteOptions){var i=n.remoteOptions.streams;for(t=i.length-1;t>=0;--t)i[t].id===this.stream.streamId&&i.splice(t,1)}}},t}(o.Event);n.StreamEvent=d},{"../../OpenVidu/Publisher":33,"../../OpenVidu/Session":34,"../Logger/OpenViduLogger":63,"./Event":43}],51:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.StreamManagerEvent=void 0;var o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.value=i,r}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.StreamManagerEvent=o},{"./Event":43}],52:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.StreamPropertyChangedEvent=void 0;var o=function(e){function t(t,n,i,r,o,s){var a=e.call(this,!1,t,"streamPropertyChanged")||this;return a.stream=n,a.changedProperty=i,a.newValue=r,a.oldValue=o,a.reason=s,a}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.StreamPropertyChangedEvent=o},{"./Event":43}],53:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.VideoElementEvent=void 0;var o=function(e){function t(t,n,i){var r=e.call(this,!1,n,i)||this;return r.element=t,r}return r(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.VideoElementEvent=o},{"./Event":43}],54:[function(e,t,n){function i(){var e={};this.forEach=function(t){for(var n in e){var i=e[n];for(var r in i)t(i[r])}},this.get=function(t,n){var i=e[n];if(null!=i)return i[t]},this.remove=function(t,n){var i=e[n];if(null!=i){for(var r in delete i[t],i)return!1;delete e[n]}},this.set=function(t,n,i){if(null==t)return this.remove(n,i);var r=e[i];null==r&&(e[i]=r={}),r[n]=t}}i.prototype.pop=function(e,t){var n=this.get(e,t);if(null!=n)return this.remove(e,t),n},t.exports=i},{}],55:[function(e,t,n){var i=e("./jsonrpcclient");n.JsonRpcClient=i},{"./jsonrpcclient":56}],56:[function(e,t,n){var i=e("../"),r=e("./transports/webSocketWithReconnection"),o=e("../../../Logger/OpenViduLogger").OpenViduLogger;Date.now=Date.now||function(){return+new Date};var s=5e3,a="RECONNECTING",c="CONNECTED",d="DISCONNECTED",u=o.getInstance();t.exports=function(e){var t,n=this,o=e.ws,l=-1,p=0,f=!0,h=!1,v=d,m=o.onreconnecting,g=o.onreconnected,b=o.onconnected,E=o.onerror;e.rpc.pull=function(e,t){t.reply(null,"push")},o.onreconnecting=function(){u.debug("--------- ONRECONNECTING -----------"),v!==a?(C(),v=a,m&&m()):u.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},o.onreconnected=function(){u.debug("--------- ONRECONNECTED -----------"),v!==c?(v=c,w(),g&&g()):u.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},o.onconnected=function(){u.debug("--------- ONCONNECTED -----------"),v!==c?(v=c,f=!0,R(),b&&b()):u.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},o.onerror=function(e){u.debug("--------- ONERROR -----------"),v=d,C(),E&&E(e)};var y=new r(o);u.debug("Connecting websocket to URI: "+o.uri);var S={request_timeout:e.rpc.requestTimeout,ping_request_timeout:e.rpc.heartbeatRequestTimeout},O=new i(i.packers.JsonRPC,S,y,function(t){u.debug("Received request: "+JSON.stringify(t));try{var n=e.rpc[t.method];void 0===n?u.error("Method "+t.method+" not registered in client"):n(t.params,t)}catch(e){u.error("Exception processing request: "+JSON.stringify(t)),u.error(e)}});function w(){u.debug("notReconnectIfNumLessThan = "+p+" (old="+l+")"),l=p}function I(){if(f){var t=null;0!=p&&p!=l||(t={interval:e.heartbeat||s}),p++,n.send("ping",t,(i=p,function(e,t){e&&(u.debug("Error in ping request #"+i+" ("+e.message+")"),i>l&&(f=!1,w(),u.debug("Server did not respond to ping message #"+i+". Reconnecting... "),y.reconnectWs()))}))}else u.debug("Trying to send ping, but ping is not enabled");var i}function R(){h||(u.debug("Starting ping (if configured)"),h=!0,null!=e.heartbeat&&(t=setInterval(I,e.heartbeat),I()))}function C(){clearInterval(t),h=!1,f=!1,p=-1,O.cancel()}this.send=function(e,t,n){"ping"!==e&&u.debug("Request: method:"+e+" params:"+JSON.stringify(t));var i=Date.now();O.encode(e,t,function(r,o){if(r){try{u.error("ERROR:"+r.message+" in Request: method:"+e+" params:"+JSON.stringify(t)+" request:"+r.request),r.data&&u.error("ERROR DATA:"+JSON.stringify(r.data))}catch(e){}r.requestTime=i}n&&(null!=o&&"pong"!==o.value&&u.debug("Response: "+JSON.stringify(o)),n(r,o))})},this.close=function(e,n){u.debug("Closing  with code: "+e+" because: "+n),null!=t&&(u.debug("Clearing ping interval"),clearInterval(t)),h=!1,f=!1,y.close(e,n)},this.forceClose=function(e){y.forceClose(e)},this.reconnect=function(){y.reconnectWs()},this.resetPing=function(){f=!0,p=0,R()}}},{"../":59,"../../../Logger/OpenViduLogger":63,"./transports/webSocketWithReconnection":58}],57:[function(e,t,n){var i=e("./webSocketWithReconnection");n.WebSocketWithReconnection=i},{"./webSocketWithReconnection":58}],58:[function(e,t,n){"use strict";var i=console,r=2e3,o=3e3,s=3;t.exports=function(e){var t,n=!1,a=e.uri,c=!1,d=new WebSocket(a);d.onopen=function(){i.debug("WebSocket connected to "+a),e.onconnected&&e.onconnected()},d.onerror=function(t){i.error("Could not connect to "+a+" (invoking onerror if defined)",t),e.onerror&&e.onerror(t)};var u=function(){d.readyState===s?n?i.debug("Connection closed by user"):(i.debug("Connection closed unexpectecly. Reconnecting..."),l(r,1)):i.debug("Close callback from previous websocket. Ignoring it")};function l(n,r){if(i.debug("reconnect (attempt #"+r+", max="+n+")"),1===r){if(c)return void i.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");c=!0,e.onreconnecting&&e.onreconnecting()}!function(n,r){i.debug("Reconnection attempt #"+r),d.close(),(d=new WebSocket(a)).onopen=function(){i.debug("Reconnected to "+a+" after "+r+" attempts..."),c=!1,t(),e.onreconnected()&&e.onreconnected(),d.onclose=u},d.onerror=function(t){i.warn("Reconnection error: ",t),r===n?e.ondisconnect&&e.ondisconnect():setTimeout(function(){l(n,r+1)},o)}}(n,r)}d.onclose=u,this.close=function(){n=!0,d.close()},this.reconnectWs=function(){i.debug("reconnectWs"),l(r,1)},this.send=function(e){d.send(e)},this.addEventListener=function(e,n){(t=function(){d.addEventListener(e,n)})()}}},{}],59:[function(e,t,n){var i=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){i=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r});var r=e("events").EventEmitter,o=e("inherits"),s=e("./packers"),a=e("./Mapper"),c=5e3;function d(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function u(e,t){i?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function l(e,t,n,s){var l=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var p=function(e){if(!e)return{};for(var t in e){var n=e[t];"string"==typeof n&&(e[t]={response:n})}return e}(e.responseMethods);if(t instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after onRequest");s=t,n=void 0,t=void 0}if(t&&t.send instanceof Function){if(n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");s=n,n=t,t=void 0}if(n instanceof Function){if(null!=s)throw new SyntaxError("There can't be parameters after onRequest");s=n,n=void 0}if(n&&n.send instanceof Function&&s&&!(s instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},r.call(this),s&&this.on("request",s),i?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var f=t.max_retries||0;function h(e){l.decode(e.data||e)}this.getTransport=function(){return n},this.setTransport=function(e){n&&(n.removeEventListener?n.removeEventListener("message",h):n.removeListener&&n.removeListener("data",h)),e&&(e.addEventListener?e.addEventListener("message",h):e.addListener&&e.addListener("data",h)),n=d(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(n);var v=t.request_timeout||c,m=t.ping_request_timeout||v,g=t.response_timeout||c,b=t.duplicates_timeout||c,E=0,y=new a,S=new a,O=new a,w={};function I(e,t){var n=setTimeout(function(){O.remove(e,t)},b);O.set(n,e,t)}function R(t,n,r,o,s){u.call(this,t,n),this.getTransport=function(){return s},this.setTransport=function(e){s=d(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var a=S.get(r,o);s||l.getTransport()||(i?this.duplicated=Boolean(a):Object.defineProperty(this,"duplicated",{value:Boolean(a)}));var c=p[t];this.pack=e.pack.bind(e,this,r),this.reply=function(t,n,i){if(t instanceof Function||t&&t.send instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after callback");i=t,n=null,t=void 0}else if(n instanceof Function||n&&n.send instanceof Function){if(null!=i)throw new SyntaxError("There can't be parameters after callback");i=n,n=null}var s;if(i=d(i),a&&clearTimeout(a.timeout),null!=o&&(t&&(t.dest=o),n&&(n.dest=o)),t||null!=n){if(null!=l.peerID&&(t?t.from=l.peerID:n.from=l.peerID),c)if(null==c.error&&t)s={error:t};else s={method:t?c.error:c.response,params:t||n};else s={error:t,result:n};s=e.pack(s,r)}else s=a?a.message:e.pack({result:null},r);return function(e,t,n){var i={message:e,timeout:setTimeout(function(){S.remove(t,n)},g)};S.set(i,t,n)}(s,r,o),(i=i||this.getTransport()||l.getTransport())?i.send(s):s}}function C(e){var t=w[e];if(t){delete w[e];var n=y.pop(t.id,t.dest);n&&(clearTimeout(n.timeout),I(t.id,t.dest))}}o(R,u),this.cancel=function(e){if(e)return C(e);for(var e in w)C(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(4003,"Cancel request"),this.cancel(),O.forEach(clearTimeout),S.forEach(function(e){clearTimeout(e.timeout)})},this.encode=function(t,n,i,r,o){if(n instanceof Function){if(null!=i)throw new SyntaxError("There can't be parameters after callback");o=n,r=void 0,i=void 0,n=void 0}else if(i instanceof Function){if(null!=r)throw new SyntaxError("There can't be parameters after callback");o=i,r=void 0,i=void 0}else if(r instanceof Function){if(null!=o)throw new SyntaxError("There can't be parameters after callback");o=r,r=void 0}null!=l.peerID&&((n=n||{}).from=l.peerID),null!=i&&((n=n||{}).dest=i);var s={method:t,params:n};if(o){var a=E++,c=0;function u(e,t){l.cancel(s),o(e,t)}var h={message:s=e.pack(s,a),callback:u,responseMethods:p[t]||{}},g=d(r);function b(e){var n="ping"===t?m:v;return h.timeout=setTimeout(I,n*Math.pow(2,c++)),w[s]={id:a,dest:i},y.set(h,a,i),(e=e||g||l.getTransport())?e.send(s):s}function S(e){e=d(e),console.warn(c+" retry for request message:",s);var t=O.pop(a,i);return clearTimeout(t),b(e)}function I(){if(c<f)return S(r);var e=new Error("Request has timed out");e.request=s,e.retry=S,u(e)}return b(r)}return s=e.pack(s),(r=r||this.getTransport())?r.send(s):s},this.decode=function(t,n){if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(e){return console.debug(e,t)}var i=t.id,r=t.ack,o=t.method,s=t.params||{},a=s.from,c=s.dest;if(null==l.peerID||a!=l.peerID){if(null==i&&null==r){var p=new u(o,s);if(l.emit("request",p))return;return p}if(o){if(null==c||c==l.peerID){if(m=y.get(r,a)){var f=m.responseMethods;return o==f.error?E(m,s):o==f.response?E(m,null,s):b()}if(g=O.get(r,a))return w(g)}return b()}var h=t.error,v=t.result;if(!(h&&h.dest&&h.dest!=l.peerID||v&&v.dest&&v.dest!=l.peerID)){var m,g;if(!(m=y.get(r,a)))return(g=O.get(r,a))?w(g):console.warn("No callback was defined for this message",t);E(m,h,v)}}function b(){if(n=d(n)||l.getTransport()){var e=S.get(i,a);if(e)return n.send(e.message)}var t=new R(o,s,null!=i?i:r,a,n);if(!l.emit("request",t))return t}function E(e,t,n){e.callback(t,n)}function w(e){console.warn("Response already processed",t),clearTimeout(e),I(r,a)}}}o(l,r),l.RpcNotification=u,t.exports=l;var p=e("./clients"),f=e("./clients/transports");l.clients=p,l.clients.transports=f,l.packers=s},{"./Mapper":54,"./clients":55,"./clients/transports":57,"./packers":62,events:1,inherits:6}],60:[function(e,t,n){n.pack=function(e,t){var n={jsonrpc:"2.0"};if(e.method)n.method=e.method,e.params&&(n.params=e.params),null!=t&&(n.id=t);else if(null!=t){if(e.error){if(void 0!==e.result)throw new TypeError("Both result and error are defined");n.error=e.error}else{if(void 0===e.result)throw new TypeError("No result or error is defined");n.result=e.result}n.id=t}return JSON.stringify(n)},n.unpack=function(e){var t=e;("string"==typeof e||e instanceof String)&&(t=JSON.parse(e));var n=t.jsonrpc;if("2.0"!==n)throw new TypeError("Invalid JsonRPC version '"+n+"': "+e);if(null==t.method){if(null==t.id)throw new TypeError("Invalid message: "+e);var i=void 0!==t.result,r=void 0!==t.error;if(i&&r)throw new TypeError("Both result and error are defined: "+e);if(!i&&!r)throw new TypeError("No result or error is defined: "+e);t.ack=t.id,delete t.id}return t}},{}],61:[function(e,t,n){n.pack=function(e){throw new TypeError("Not yet implemented")},n.unpack=function(e){throw new TypeError("Not yet implemented")}},{}],62:[function(e,t,n){var i=e("./JsonRPC"),r=e("./XmlRPC");n.JsonRPC=i,n.XmlRPC=r},{"./JsonRPC":60,"./XmlRPC":61}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OpenViduLogger=void 0;var i=function(){function e(){this.logger=window.console,this.LOG_FNS=[this.logger.log,this.logger.debug,this.logger.info,this.logger.warn,this.logger.error],this.isProdMode=!1}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[0].apply(this.logger,arguments)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[1].apply(this.logger,arguments)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[2].apply(this.logger,arguments)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[3].apply(this.logger,arguments)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.LOG_FNS[4].apply(this.logger,arguments)},e.prototype.enableProdMode=function(){this.isProdMode=!0},e}();n.OpenViduLogger=i},{}],64:[function(e,t,n){function i(e,t,n){var i={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return n&&(i.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(i.video.mandatory.chromeMediaSourceId=t,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=t)),i}function r(e){o?o.isLoaded?e?e.forEach?o.contentWindow.postMessage({captureCustomSourceId:e},"*"):o.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):o.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout(function(){r(e)},100):s(function(){r(e)})}var o;function s(e){o?e():((o=document.createElement("iframe")).onload=function(){o.isLoaded=!0,e()},o.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",o.style.display="none",(document.body||document.documentElement).appendChild(o))}function a(){o?o.isLoaded?o.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(a,100):s(a)}window.getScreenId=function(e,t,n){-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?t(null,"firefox",{video:{mozMediaSource:e,mediaSource:e}}):(window.addEventListener("message",function e(n){if(!n.data)return;n.data.chromeMediaSourceId&&("PermissionDeniedError"===n.data.chromeMediaSourceId?t("permission-denied"):t(null,n.data.chromeMediaSourceId,i(null,n.data.chromeMediaSourceId,n.data.canRequestAudioTrack)),window.removeEventListener("message",e));n.data.chromeExtensionStatus&&(t(n.data.chromeExtensionStatus,null,i(n.data.chromeExtensionStatus)),window.removeEventListener("message",e))}),n?setTimeout(function(){r(n)},100):setTimeout(r,100)):t({video:!0})},window.getScreenConstraints=function(e){s(function(){getScreenId(function(t,n,i){i||(i={video:!0}),e(t,i.video)})})},window.getChromeExtensionStatus=function(e){navigator.mozGetUserMedia?e("installed-enabled"):(window.addEventListener("message",function t(n){if(!n.data)return;n.data.chromeExtensionStatus&&(e(n.data.chromeExtensionStatus),window.removeEventListener("message",t))}),setTimeout(a,100))},n.getScreenId=window.getScreenId},{}],65:[function(e,t,n){var i,r,o="screen";if("undefined"!=typeof window&&"undefined"!=typeof navigator&&void 0!==navigator.userAgent){var s=void 0!==window.InstallTrigger,a=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.addEventListener("message",function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e){if(r)return r("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(o="desktop");e.sourceId&&r&&r(i=e.sourceId,!0===e.canRequestAudioTrack)}(e.data)})}function c(e){if(!e)throw'"callback" parameter is mandatory.';if(i)return e(i);r=e,window.postMessage("get-sourceId","*")}function d(e,t){i="";if(s)return e(null,{mozMediaSource:"window",mediaSource:"window"});var n={mandatory:{chromeMediaSource:o,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=o||i?("desktop"==o&&(n.mandatory.chromeMediaSourceId=i),e(null,n)):t?function(e){if(!e)throw'"callback" parameter is mandatory.';if(i)return e(i);r=e,window.postMessage("audio-plus-tab","*")}(function(t,i){n.mandatory.chromeMediaSourceId=t,i&&(n.canRequestAudioTrack=!0),e("PermissionDeniedError"==t?t:null,n)}):c(function(t){n.mandatory.chromeMediaSourceId=t,e("PermissionDeniedError"==t?t:null,n)})}n.getScreenConstraints=d,n.getScreenConstraintsWithAudio=function(e){d(e,!0)},n.isChromeExtensionAvailable=function(e){if(e){if("desktop"==o)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=o)},2e3)}},n.getChromeExtensionStatus=function(e,t){if(s)return t("not-chrome");2!=arguments.length&&(t=e,e="lfcgfepafnobdloecchnfaclibenjold");var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){o="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==o?"installed-disabled":"installed-enabled")},2e3)},n.onerror=function(){t("not-installed")}},n.getSourceId=c},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PlatformUtils=void 0;var i=e("platform"),r=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),e.instance},e.prototype.isChromeBrowser=function(){return"Chrome"===i.name},e.prototype.isSafariBrowser=function(){return"Safari"===i.name},e.prototype.isChromeMobileBrowser=function(){return"Chrome Mobile"===i.name},e.prototype.isFirefoxBrowser=function(){return"Firefox"===i.name},e.prototype.isFirefoxMobileBrowser=function(){return"Firefox Mobile"===i.name},e.prototype.isOperaBrowser=function(){return"Opera"===i.name},e.prototype.isOperaMobileBrowser=function(){return"Opera Mobile"===i.name},e.prototype.isEdgeBrowser=function(){var e=(null==i?void 0:i.version)?parseFloat(i.version):-1;return"Microsoft Edge"===i.name&&e>=80},e.prototype.isEdgeMobileBrowser=function(){var e,t=(null==i?void 0:i.version)?parseFloat(i.version):-1;return"Microsoft Edge"===i.name&&"Android"===(null===(e=i.os)||void 0===e?void 0:e.family)&&t>45},e.prototype.isAndroidBrowser=function(){return"Android Browser"===i.name},e.prototype.isElectron=function(){return"Electron"===i.name},e.prototype.isSamsungBrowser=function(){return"Samsung Internet Mobile"===i.name||"Samsung Internet"===i.name},e.prototype.isIPhoneOrIPad=function(){var e=i.ua?i.ua:navigator.userAgent,t="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(e)&&t,r=/\b(\w*iPhone\w*)\b/.test(e)&&/\b(\w*Mobile\w*)\b/.test(e)&&t;return n||r},e.prototype.isIOSWithSafari=function(){var e=i.ua?i.ua:navigator.userAgent;return/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(e)&&!/\b(\w*CriOS\w*)\b/.test(e)&&!/\b(\w*FxiOS\w*)\b/.test(e)},e.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&-1===i.ua.indexOf("Safari")},e.prototype.isIonicAndroid=function(){return"Android"===i.os.family&&"Android Browser"==i.name},e.prototype.isMobileDevice=function(){return"iOS"===i.os.family||"Android"===i.os.family},e.prototype.isReactNative=function(){return!1},e.prototype.canScreenShare=function(){var e=(null==i?void 0:i.version)?parseFloat(i.version):-1;return!this.isMobileDevice()&&(this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&e>=13)},e.prototype.getName=function(){return i.name||""},e.prototype.getVersion=function(){return i.version||""},e.prototype.getFamily=function(){return i.os.family||""},e.prototype.getDescription=function(){return i.description||""},e}();n.PlatformUtils=r},{platform:8}],67:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.WebRtcPeerSendrecv=n.WebRtcPeerSendonly=n.WebRtcPeerRecvonly=n.WebRtcPeer=void 0;var o,s=e("freeice"),a=e("uuid"),c=e("../Logger/OpenViduLogger"),d=e("../Utils/Platform"),u=c.OpenViduLogger.getInstance(),l=function(){function e(e){var t=this;this.configuration=e,this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],this.candidategatheringdone=!1,o=d.PlatformUtils.getInstance(),this.configuration.iceServers=this.configuration.iceServers&&this.configuration.iceServers.length>0?this.configuration.iceServers:s(),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.id=e.id?e.id:this.generateUniqueId(),this.pc.onicecandidate=function(e){if(e.candidate){var n=e.candidate;n?(t.localCandidatesQueue.push({candidate:n.candidate}),t.candidategatheringdone=!1,t.configuration.onicecandidate(e.candidate)):t.candidategatheringdone||(t.candidategatheringdone=!0)}},this.pc.onsignalingstatechange=function(){if("stable"===t.pc.signalingState)for(;t.iceCandidateList.length>0;){var e=t.iceCandidateList.shift();t.pc.addIceCandidate(e)}},this.start()}return e.prototype.start=function(){var e=this;return new Promise(function(t,n){if("closed"===e.pc.signalingState&&n('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),e.configuration.mediaStream){for(var i=0,r=e.configuration.mediaStream.getTracks();i<r.length;i++){var o=r[i];e.pc.addTrack(o,e.configuration.mediaStream)}t()}})},e.prototype.dispose=function(){if(u.debug("Disposing WebRtcPeer"),this.pc){if("closed"===this.pc.signalingState)return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},e.prototype.generateOffer=function(){var e=this;return new Promise(function(t,n){var i,r=!0;e.configuration.mediaConstraints&&(i="boolean"!=typeof e.configuration.mediaConstraints.audio||e.configuration.mediaConstraints.audio,r="boolean"!=typeof e.configuration.mediaConstraints.video||e.configuration.mediaConstraints.video);var s={offerToReceiveAudio:"sendonly"!==e.configuration.mode&&i,offerToReceiveVideo:"sendonly"!==e.configuration.mode&&r};u.debug("RTCPeerConnection constraints: "+JSON.stringify(s)),o.isSafariBrowser()&&!o.isIonicIos()?(i&&e.pc.addTransceiver("audio",{direction:e.configuration.mode}),r&&e.pc.addTransceiver("video",{direction:e.configuration.mode}),e.pc.createOffer().then(function(t){return u.debug("Created SDP offer"),e.pc.setLocalDescription(t)}).then(function(){var i=e.pc.localDescription;i?(u.debug("Local description set",i.sdp),t(i.sdp)):n("Local description is not defined")}).catch(function(e){return n(e)})):e.pc.createOffer(s).then(function(t){return u.debug("Created SDP offer"),e.pc.setLocalDescription(t)}).then(function(){var i=e.pc.localDescription;i?(u.debug("Local description set",i.sdp),t(i.sdp)):n("Local description is not defined")}).catch(function(e){return n(e)})})},e.prototype.processAnswer=function(e,t){var n=this;return new Promise(function(i,r){var o={type:"answer",sdp:e};u.debug("SDP answer received, setting remote description"),"closed"===n.pc.signalingState&&r("RTCPeerConnection is closed"),n.setRemoteDescription(o,t,i,r)})},e.prototype.setRemoteDescription=function(e,t,n,i){var r=this;o.isIonicIos()?t?setTimeout(function(){u.info("setRemoteDescription run after timeout for Ionic iOS device"),r.pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){return n()}).catch(function(e){return i(e)})},250):this.pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){return n()}).catch(function(e){return i(e)}):this.pc.setRemoteDescription(e).then(function(){return n()}).catch(function(e){return i(e)})},e.prototype.addIceCandidate=function(e){var t=this;return new Promise(function(n,i){switch(u.debug("Remote ICE candidate received",e),t.remoteCandidatesQueue.push(e),t.pc.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":t.pc.remoteDescription?t.pc.addIceCandidate(e).then(function(){return n()}).catch(function(e){return i(e)}):(t.iceCandidateList.push(e),n());break;default:t.iceCandidateList.push(e),n()}})},e.prototype.addIceConnectionStateChangeListener=function(e){var t=this;this.pc.oniceconnectionstatechange=function(){switch(t.pc.iceConnectionState){case"disconnected":u.warn("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "disconnected". Possible network disconnection');break;case"failed":u.error("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') to "failed"');break;case"closed":u.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "closed"');break;case"new":u.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "new"');break;case"checking":u.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "checking"');break;case"connected":u.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "connected"');break;case"completed":u.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "completed"')}}},e.prototype.generateUniqueId=function(){return a.v4()},e}();n.WebRtcPeer=l;var p=function(e){function t(t){return t.mode="recvonly",e.call(this,t)||this}return r(t,e),t}(l);n.WebRtcPeerRecvonly=p;var f=function(e){function t(t){return t.mode="sendonly",e.call(this,t)||this}return r(t,e),t}(l);n.WebRtcPeerSendonly=f;var h=function(e){function t(t){return t.mode="sendrecv",e.call(this,t)||this}return r(t,e),t}(l);n.WebRtcPeerSendrecv=h},{"../Logger/OpenViduLogger":63,"../Utils/Platform":66,freeice:2,uuid:9}],68:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WebRtcStats=void 0;var o,s=e("../Logger/OpenViduLogger"),a=e("../Utils/Platform"),c=s.OpenViduLogger.getInstance(),d=function(){function e(e){this.stream=e,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,o=a.PlatformUtils.getInstance()}return e.prototype.isEnabled=function(){return this.webRtcStatsEnabled},e.prototype.initWebRtcStats=function(){var e=this,t=localStorage.getItem(this.STATS_ITEM_NAME);if(t){this.webRtcStatsEnabled=!0;var n=JSON.parse(t);c.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),c.warn("localStorage item: "+JSON.stringify(n)),this.POST_URL=n.httpEndpoint,this.statsInterval=n.interval,this.webRtcStatsIntervalId=setInterval(function(){return i(e,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return e.sent(),[2]}})})},1e3*this.statsInterval)}else c.debug("WebRtc stats not enabled")},e.prototype.getSelectedIceCandidateInfo=function(){var e=this;return new Promise(function(t,n){e.getStats().then(function(i){if(o.isChromeBrowser()||o.isChromeMobileBrowser()||o.isOperaBrowser()||o.isOperaMobileBrowser()){var r=void 0,s=void 0,a=void 0,c={},d={};for(var u in i){var l=i[u];"localcandidate"===l.type?c[l.id]=l:"remotecandidate"===l.type?d[l.id]=l:"googCandidatePair"===l.type&&"true"===l.googActiveConnection&&(a=l,r=l.localCandidateId,s=l.remoteCandidateId)}var p=c[r];if(p){var f=e.stream.getLocalIceCandidateList().filter(function(e){return!!e.candidate&&e.candidate.indexOf(p.ipAddress)>=0&&e.candidate.indexOf(p.portNumber)>=0&&e.candidate.indexOf(p.priority)>=0});p.raw=f[0]?f[0].candidate:"ERROR: Cannot find local candidate in list of sent ICE candidates"}else p="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";var h=d[s];if(h){f=e.stream.getRemoteIceCandidateList().filter(function(e){return!!e.candidate&&e.candidate.indexOf(h.ipAddress)>=0&&e.candidate.indexOf(h.portNumber)>=0&&e.candidate.indexOf(h.priority)>=0});h.raw=f[0]?f[0].candidate:"ERROR: Cannot find remote candidate in list of received ICE candidates"}else h="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";t({googCandidatePair:a,localCandidate:p,remoteCandidate:h})}else n("Selected ICE candidate info only available for Chrome")}).catch(function(e){n(e)})})},e.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),c.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},e.prototype.sendStats=function(e,t){return i(this,void 0,void 0,function(){var n,i;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n={headers:{"Content-type":"application/json"},body:JSON.stringify(t),method:"POST"},[4,fetch(e,n)];case 1:return r.sent(),[3,3];case 2:return i=r.sent(),c.error(i),[3,3];case 3:return[2]}})})},e.prototype.sendStatsToHttpEndpoint=function(){return i(this,void 0,void 0,function(){var e,t,n;return r(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.getStats()];case 1:return e=i.sent(),t=this.generateJSONStatsResponse(e),[4,this.sendStats(this.POST_URL,t)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),c.log(n),[3,4];case 4:return[2]}})})},e.prototype.getStats=function(){return i(this,void 0,void 0,function(){var e=this;return r(this,function(t){return[2,new Promise(function(t,n){return i(e,void 0,void 0,function(){var e,n,i=this;return r(this,function(r){switch(r.label){case 0:return o.isChromeBrowser()||o.isChromeMobileBrowser()||o.isOperaBrowser()||o.isOperaMobileBrowser()?(this.stream.getRTCPeerConnection().getStats(function(e){var n=e.result().filter(function(e){return"ssrc"===e.type}),r=i.initWebRtcStatsResponse();n.forEach(function(e){var t=e.names(),n=e.stat("mediaType"),i="audio"===n&&t.includes("audioOutputLevel"),o="video"===n&&t.includes("qpSum"),s=t.includes("bytesReceived")&&(i||o),a=t.includes("bytesSent");s?(r.inbound[n].bytesReceived=Number(e.stat("bytesReceived")),r.inbound[n].packetsReceived=Number(e.stat("packetsReceived")),r.inbound[n].packetsLost=Number(e.stat("packetsLost")),"video"===n&&(r.inbound.video.framesDecoded=Number(e.stat("framesDecoded")),r.inbound.video.nackCount=Number(e.stat("nackCount")))):a&&(r.outbound[n].bytesSent=Number(e.stat("bytesSent")),r.outbound[n].packetsSent=Number(e.stat("packetsSent")),"video"===n&&(r.outbound.video.framesEncoded=Number(e.stat("framesEncoded")),r.outbound.video.nackCount=Number(e.stat("nackCount"))))}),t(r)}),[3,3]):[3,1];case 1:return[4,this.stream.getRTCPeerConnection().getStats(null)];case 2:return e=r.sent(),n=this.initWebRtcStatsResponse(),e.forEach(function(e){var t=e.mediaType;switch(e.type){case"outbound-rtp":n.outbound[t].bytesSent=Number(e.bytesSent),n.outbound[t].packetsSent=Number(e.packetsSent),"video"===t&&(n.outbound[t].framesEncoded=Number(e.framesEncoded));break;case"inbound-rtp":n.inbound[t].bytesReceived=Number(e.bytesReceived),n.inbound[t].packetsReceived=Number(e.packetsReceived),n.inbound[t].packetsLost=Number(e.packetsLost),"video"===t&&(n.inbound[t].framesDecoded=Number(e.framesDecoded),n.inbound[t].nackCount=Number(e.nackCount))}}),[2,t(n)];case 3:return[2]}})})})]})})},e.prototype.generateJSONStatsResponse=function(e){return{"@timestamp":(new Date).toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:o.getName(),platform_description:o.getDescription(),stream:"webRTC",webrtc_stats:e}},e.prototype.initWebRtcStatsResponse=function(){return{inbound:{audio:{},video:{}},outbound:{audio:{},video:{}}}},e}();n.WebRtcStats=d},{"../Logger/OpenViduLogger":63,"../Utils/Platform":66}]},{},[27]);
    </script>
</head>

<body style="height: 100vh; width: 100vw; margin: 0; padding: 0;">
<div id="videos"
     style="height: 100vh; width: 100vw; margin: 0; padding: 0; display: flex; justify-content: center; align-content: center"></div>
<div id="videoInvisible" style="display: none"></div>
</body>

<script>
    var url = new URL(window.location.href);
    var SESSION_ID = url.searchParams.get("sessionId");
    var SECRET = url.searchParams.get("secret");
    // var TOKEN = 'wss://' + location.host + '?sessionId=' + SESSION_ID + '&secret=' + SECRET + '&recorder=true';
    var TOKEN = 'wss://' + "openvidudemo.me" + '?sessionId=' + SESSION_ID + '&secret=' + SECRET + '&recorder=true';

    var OV = new OpenVidu();
    var session = OV.initSession();

    session.on("streamCreated", (event) => {
        var data = event.stream.connection.data;
        data = JSON.parse(data);

        if (data.device === "desktop") {
            session.subscribe(event.stream, 'videoInvisible');
        } else {
            session.subscribe(event.stream, 'videos');
        }
    });
    session.connect(TOKEN)
        .then(() => {
            console.log('Recorder participant connected')
        })
        .catch(error => {
            console.error(error)
        });
</script>

</html>
